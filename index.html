<!DOCTYPE html>
<html lang="en">
<head>
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       META â€” PWA / GitHub Pages
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="theme-color" content="#0d1b3e" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="BUK Nav" />
  <meta name="description" content="Interactive campus navigation for Bayero University Kano (BUK) Old Site." />
  <meta property="og:title" content="BUK Navigate â€” Old Site" />
  <meta property="og:description" content="Interactive campus map for Bayero University Kano." />
  <meta property="og:type" content="website" />
  <title>BUK Navigate â€” Old Site</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=DM+Sans:ital,wght@0,300;0,400;0,500;0,600;1,400&display=swap" rel="stylesheet" />

  <style>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       DESIGN TOKENS â€” DARK MODE (default)
       Every UI colour is a CSS variable.
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    :root {
      --maroon:        #7b1d2e;
      --maroon-b:      #a8293e;
      --gold:          #c9973a;
      --gold-soft:     rgba(201,151,58,0.13);
      --gold-ring:     rgba(201,151,58,0.45);
      --blue-dot:      #1976d2;

      --bg:            #121212;
      --surface:       #1c2030;
      --surface-alt:   #242840;
      --surface-raised:#2e3454;

      --border:        rgba(255,255,255,0.09);
      --glass:         rgba(18,18,18,0.88);
      --header-bg:     rgba(13,15,26,0.95);

      --text-primary:  #e0e0e0;
      --text-secondary:#9aa3bc;
      --text-on-brand: #ffffff;
      --text-muted:    #6b748e;

      --ctrl-bg:       rgba(28,32,48,0.94);
      --ctrl-border:   rgba(255,255,255,0.10);
      --ctrl-icon:     #e0e0e0;

      --dropdown-bg:   #1c2030;
      --dropdown-hover:rgba(255,255,255,0.06);
      --dropdown-div:  rgba(255,255,255,0.05);

      --legend-text:   #c4cad8;

      --panel-bg:      #1c2030;
      --panel-tab-active:      #2e3454;
      --panel-tab-text:        #9aa3bc;
      --panel-tab-active-text: #e0e0e0;
      --chip-bg:       #242840;
      --chip-border:   rgba(255,255,255,0.07);

      --card-bg:       rgba(201,151,58,0.10);
      --card-border:   rgba(201,151,58,0.22);

      --toast-bg:      #2e3454;
      --toast-text:    #e0e0e0;
      --toast-border:  rgba(255,255,255,0.10);

      --err-bg:        #2a1818;
      --err-border:    rgba(168,41,62,0.45);
      --err-text:      #f4a0a0;

      --admin-bg:      rgba(201,151,58,0.18);
      --admin-border:  rgba(201,151,58,0.55);
      --admin-text:    #f0c060;

      /* Legend poly swatches */
      --legend-poly-idle:   rgba(100,140,220,0.18);
      --legend-poly-stroke: rgba(100,160,255,0.55);
      --legend-poly-active: rgba(201,151,58,0.28);

      --scroll-thumb:  rgba(255,255,255,0.14);
      --map-filter:    saturate(0.72) brightness(0.82);

      --radius:    14px;
      --radius-lg: 20px;
      --shadow:    0 8px 28px rgba(0,0,0,0.42);
      --shadow-lg: 0 20px 60px rgba(0,0,0,0.58);
      --ease:      cubic-bezier(0.4,0,0.2,1);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       LIGHT MODE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    body.light {
      --bg:            #edf0f8;
      --surface:       #ffffff;
      --surface-alt:   #edf0f8;
      --surface-raised:#dde3f4;
      --border:        rgba(13,27,62,0.11);
      --glass:         rgba(237,240,248,0.94);
      --header-bg:     rgba(11,20,50,0.97);
      --text-primary:  #0d1b3e;
      --text-secondary:#4a5580;
      --text-muted:    #7a85a8;
      --ctrl-bg:       rgba(255,255,255,0.96);
      --ctrl-border:   rgba(13,27,62,0.14);
      --ctrl-icon:     #0d1b3e;
      --dropdown-bg:   #ffffff;
      --dropdown-hover:rgba(13,27,62,0.05);
      --dropdown-div:  rgba(13,27,62,0.06);
      --legend-text:   #2a3a6a;
      --panel-bg:      #ffffff;
      --panel-tab-active:      #0d1b3e;
      --panel-tab-text:        #4a5580;
      --panel-tab-active-text: #ffffff;
      --chip-bg:       #edf0f8;
      --chip-border:   rgba(13,27,62,0.09);
      --card-bg:       rgba(201,151,58,0.07);
      --card-border:   rgba(201,151,58,0.18);
      --toast-bg:      #0d1b3e;
      --toast-text:    #ffffff;
      --toast-border:  rgba(255,255,255,0.14);
      --err-bg:        #fff0f0;
      --err-border:    rgba(168,41,62,0.26);
      --err-text:      #7b1d2e;
      --legend-poly-idle:   rgba(13,27,62,0.10);
      --legend-poly-stroke: rgba(13,27,62,0.40);
      --legend-poly-active: rgba(201,151,58,0.20);
      --scroll-thumb:  rgba(13,27,62,0.14);
      --map-filter:    saturate(1) brightness(1);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BASE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html, body {
      height: 100%; overflow: hidden;
      font-family: 'DM Sans', sans-serif;
      background: var(--bg); color: var(--text-primary);
      padding-top: env(safe-area-inset-top);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MAP
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #map {
      position: absolute; inset: 0; z-index: 0;
      filter: var(--map-filter);
      transition: filter 0.45s var(--ease);
    }
    body.admin-mode #map { cursor: crosshair !important; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       LEAFLET OVERRIDES
       All chrome uses CSS vars so it flips with theme
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .leaflet-control-zoom { display: none !important; }
    .leaflet-control-attribution {
      background: var(--glass) !important;
      color: var(--text-secondary) !important;
      font-size: 10px !important;
      backdrop-filter: blur(8px);
      border-radius: 8px 0 0 0 !important;
      padding: 3px 8px !important;
      border-top: 1px solid var(--border) !important;
    }
    .leaflet-control-attribution a { color: var(--gold) !important; }
    .leaflet-popup-content-wrapper {
      background: var(--surface) !important; color: var(--text-primary) !important;
      border-radius: var(--radius) !important; box-shadow: var(--shadow) !important;
      border: 1px solid var(--border) !important;
    }
    .leaflet-popup-tip { background: var(--surface) !important; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ZOOM-DEPENDENT BUILDING LABELS (Task 2)
       â€” .buk-label-wrap is the transparent Leaflet
         icon container; .buk-label is the visible text.
       â€” Body class .light flips to dark-text+white-halo.
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .buk-label-wrap {
      background: transparent !important;
      border: none !important;
      overflow: visible !important;
    }
    .buk-label {
      display: inline-block;
      transform: translate(-50%, -50%);  /* centre on coord */
      white-space: nowrap;
      pointer-events: none;
      user-select: none;
      font-family: 'DM Sans', sans-serif;
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 0.04em;
      color: #ffffff;
      /* Thick dark halo â€” readable on both light & dark tiles */
      text-shadow:
        -1px -1px 0 rgba(0,0,0,0.90),
         1px -1px 0 rgba(0,0,0,0.90),
        -1px  1px 0 rgba(0,0,0,0.90),
         1px  1px 0 rgba(0,0,0,0.90),
         0    0   5px rgba(0,0,0,0.80),
         0    0   9px rgba(0,0,0,0.50);
      padding: 2px 0;
      opacity: 0;
      transition: opacity 0.35s var(--ease);
    }
    .buk-label.visible { opacity: 1; }
    /* Light mode: dark text + white halo */
    body.light .buk-label {
      color: #0a1428;
      text-shadow:
        -1px -1px 0 rgba(255,255,255,0.95),
         1px -1px 0 rgba(255,255,255,0.95),
        -1px  1px 0 rgba(255,255,255,0.95),
         1px  1px 0 rgba(255,255,255,0.95),
         0    0   6px rgba(255,255,255,0.90),
         0    0  10px rgba(255,255,255,0.60);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ENTRANCE DOT â€” small elegant pin (Task 1)
       Appears at the building entrance on activation.
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .entrance-dot {
      width: 11px; height: 11px; border-radius: 50%;
      border: 2.5px solid #ffffff;
      box-shadow: 0 2px 10px rgba(0,0,0,0.55), 0 0 0 1px rgba(0,0,0,0.12);
      transition: transform 0.2s;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SEARCH PULSE MARKER â€” gold ring (Task 3)
       Temporary marker dropped on search activation.
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    @keyframes search-ring {
      0%   { transform: scale(1);   opacity: 0.80; }
      65%  { transform: scale(3.2); opacity: 0; }
      100% { transform: scale(3.2); opacity: 0; }
    }
    .sp-wrap {
      position: relative;
      width: 18px; height: 18px;
      display: flex; align-items: center; justify-content: center;
    }
    .sp-ring {
      position: absolute;
      width: 18px; height: 18px; border-radius: 50%;
      animation: search-ring 1.8s ease-out infinite;
    }
    .sp-core {
      position: relative; z-index: 1;
      width: 12px; height: 12px; border-radius: 50%;
      border: 2.5px solid #ffffff;
      box-shadow: 0 2px 12px rgba(201,151,58,0.70);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       BLUE PULSE DOT (live location)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    @keyframes blue-ring {
      0%   { transform: scale(1);   opacity: 0.75; }
      70%  { transform: scale(2.8); opacity: 0; }
      100% { transform: scale(2.8); opacity: 0; }
    }
    .bd-wrap  { position: relative; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; }
    .bd-ring  { position: absolute; width: 20px; height: 20px; border-radius: 50%; background: rgba(25,118,210,0.38); animation: blue-ring 2.2s ease-out infinite; }
    .bd-core  { position: relative; z-index: 1; width: 14px; height: 14px; border-radius: 50%; background: #1976d2; border: 2.5px solid #ffffff; box-shadow: 0 2px 10px rgba(25,118,210,0.65); }

    /* Admin coord pin */
    .admin-pin { width: 12px; height: 12px; border-radius: 50%; background: var(--gold); border: 2px solid #ffffff; box-shadow: 0 2px 8px rgba(201,151,58,0.7); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       HEADER
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #header {
      position: absolute; top: 0; left: 0; right: 0; z-index: 900;
      padding: 14px 14px 0;
      padding-top: calc(14px + env(safe-area-inset-top));
    }
    .header-row { display: flex; align-items: center; gap: 10px; }

    .logo {
      display: flex; align-items: center; gap: 9px;
      background: var(--maroon); color: var(--text-on-brand);
      padding: 9px 15px; border-radius: 50px;
      flex-shrink: 0; box-shadow: var(--shadow);
      text-decoration: none; user-select: none;
    }
    .logo-mark { font-size: 18px; line-height: 1; }
    .logo-text { font-family: 'Playfair Display', serif; font-size: 14px; font-weight: 700; line-height: 1; }
    .logo-sub  { font-size: 9px; font-weight: 300; opacity: 0.65; letter-spacing: 0.09em; text-transform: uppercase; }

    .search-wrap { flex: 1; position: relative; }
    #search-input {
      width: 100%; background: var(--header-bg);
      backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px);
      border: 1.5px solid rgba(255,255,255,0.10); color: var(--text-on-brand);
      font-family: 'DM Sans', sans-serif; font-size: 14px;
      padding: 11px 44px 11px 18px; border-radius: 50px; outline: none;
      box-shadow: var(--shadow); transition: border-color 0.3s;
    }
    #search-input::placeholder { color: rgba(255,255,255,0.38); opacity: 1; }
    #search-input:focus { border-color: var(--gold-ring); }
    .search-icon {
      position: absolute; right: 14px; top: 50%;
      transform: translateY(-50%); pointer-events: none; color: rgba(255,255,255,0.45);
    }
    .search-icon svg { width: 17px; height: 17px; fill: none; stroke: currentColor; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }

    .hdr-btns { display: flex; gap: 8px; flex-shrink: 0; }
    .hdr-btn {
      height: 40px; padding: 0 13px; border-radius: 50px;
      border: 1.5px solid rgba(255,255,255,0.12); background: var(--header-bg);
      backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px);
      color: var(--text-on-brand);
      font-family: 'DM Sans', sans-serif; font-size: 12px; font-weight: 600;
      cursor: pointer; display: flex; align-items: center; gap: 6px;
      box-shadow: var(--shadow); transition: background 0.2s, border-color 0.2s; white-space: nowrap;
    }
    .hdr-btn:hover { background: rgba(30,49,104,0.98); border-color: rgba(255,255,255,0.22); }
    .hdr-btn svg { width: 15px; height: 15px; fill: none; stroke: currentColor; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
    #lang-btn { min-width: 58px; justify-content: center; }
    #theme-btn { padding: 0 11px; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ADMIN BADGE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #admin-badge {
      display: none; pointer-events: none;
      position: absolute;
      top: calc(72px + env(safe-area-inset-top));
      left: 50%; transform: translateX(-50%);
      z-index: 910;
      background: var(--admin-bg); border: 1.5px solid var(--admin-border); color: var(--admin-text);
      font-size: 11px; font-weight: 700; padding: 6px 16px; border-radius: 50px;
      letter-spacing: 0.07em; text-transform: uppercase;
      backdrop-filter: blur(12px); white-space: nowrap;
      animation: badge-glow 3s ease-in-out infinite;
    }
    #admin-badge.visible { display: flex; align-items: center; gap: 7px; }
    #admin-badge svg { width: 13px; height: 13px; flex-shrink: 0; fill: none; stroke: currentColor; stroke-width: 2.5; stroke-linecap: round; stroke-linejoin: round; }
    @keyframes badge-glow {
      0%,100% { box-shadow: 0 4px 16px rgba(201,151,58,0.28); }
      50%      { box-shadow: 0 4px 24px rgba(201,151,58,0.55); }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SEARCH DROPDOWN
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #search-results {
      position: absolute; top: calc(100% + 8px); left: 0; right: 0;
      background: var(--dropdown-bg); border: 1.5px solid var(--border);
      border-radius: var(--radius); overflow: hidden;
      box-shadow: var(--shadow-lg); display: none; z-index: 999;
      max-height: 280px; overflow-y: auto;
    }
    #search-results.open { display: block; }
    .sr-item { display: flex; align-items: center; gap: 12px; padding: 11px 16px; cursor: pointer; transition: background 0.15s; border-bottom: 1px solid var(--dropdown-div); }
    .sr-item:last-child { border-bottom: none; }
    .sr-item:hover { background: var(--dropdown-hover); }
    .sr-icon { width: 34px; height: 34px; border-radius: 9px; display: grid; place-items: center; font-size: 17px; flex-shrink: 0; }
    .sr-name { font-size: 13px; font-weight: 600; color: var(--text-primary); line-height: 1.3; }
    .sr-meta { font-size: 11px; color: var(--text-secondary); margin-top: 1px; }
    .sr-score { margin-left: auto; font-size: 10px; font-weight: 700; background: var(--gold-soft); color: var(--gold); padding: 2px 8px; border-radius: 50px; flex-shrink: 0; }
    .sr-empty { padding: 18px 16px; font-size: 13px; color: var(--text-secondary); text-align: center; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       LEGEND â€” simplified for clean-map design
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #legend {
      position: absolute; left: 14px; bottom: 226px; z-index: 900;
      background: var(--glass); backdrop-filter: blur(18px); -webkit-backdrop-filter: blur(18px);
      border: 1.5px solid var(--border); border-radius: var(--radius);
      padding: 12px 14px; box-shadow: var(--shadow);
    }
    .legend-title { font-size: 9px; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.13em; margin-bottom: 9px; }
    .legend-row   { display: flex; align-items: center; gap: 9px; font-size: 11.5px; color: var(--legend-text); margin-bottom: 7px; }
    .legend-row:last-child { margin-bottom: 0; }
    /* Idle polygon swatch */
    .lg-poly {
      width: 16px; height: 11px; flex-shrink: 0; border-radius: 3px;
      background: var(--legend-poly-idle);
      border: 1.5px dashed var(--legend-poly-stroke);
    }
    /* Active polygon swatch */
    .lg-poly-active {
      width: 16px; height: 11px; flex-shrink: 0; border-radius: 3px;
      background: var(--legend-poly-active);
      border: 2px solid var(--gold);
    }
    /* Blue dot mini */
    .lg-dot-blue {
      width: 11px; height: 11px; flex-shrink: 0; border-radius: 50%;
      background: var(--blue-dot); border: 2px solid rgba(255,255,255,0.8);
      box-shadow: 0 0 6px rgba(25,118,210,0.6);
    }
    /* Zoom hint */
    .lg-zoom-hint {
      margin-top: 9px; padding-top: 9px;
      border-top: 1px solid var(--border);
      font-size: 10px; color: var(--text-muted);
      display: flex; align-items: center; gap: 6px;
    }
    .lg-zoom-hint svg { width: 11px; height: 11px; flex-shrink: 0; opacity: 0.6; fill: none; stroke: currentColor; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       FLOATING CONTROLS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #controls {
      position: absolute; right: 14px; bottom: 226px;
      z-index: 900; display: flex; flex-direction: column; gap: 9px;
    }
    .ctrl-btn {
      width: 46px; height: 46px; border-radius: 50%; border: none; cursor: pointer;
      display: grid; place-items: center;
      box-shadow: var(--shadow); transition: transform 0.18s, background 0.2s;
    }
    .ctrl-btn:active { transform: scale(0.9); }
    .ctrl-btn svg { width: 20px; height: 20px; fill: none; stroke: currentColor; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
    #btn-zi, #btn-zo, #btn-center {
      background: var(--ctrl-bg); border: 1.5px solid var(--ctrl-border); color: var(--ctrl-icon);
      backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
    }
    #btn-zi:hover, #btn-zo:hover, #btn-center:hover { background: var(--surface-raised); }
    #btn-locate { background: var(--gold); color: var(--bg); }
    #btn-locate:hover { box-shadow: 0 6px 24px rgba(201,151,58,0.60); }
    #btn-locate.tracking { background: var(--blue-dot); color: #ffffff; box-shadow: 0 6px 24px rgba(25,118,210,0.55); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       PANEL (bottom sheet / sidebar)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #panel {
      position: absolute; left: 0; right: 0; bottom: 0;
      z-index: 950; max-height: 84vh;
      transform: translateY(100%); transition: transform 0.38s var(--ease);
      display: flex; flex-direction: column; pointer-events: none;
    }
    #panel.open { transform: translateY(0); pointer-events: all; }

    .panel-inner {
      background: var(--panel-bg); border-radius: 22px 22px 0 0;
      border-top: 1.5px solid var(--border);
      box-shadow: 0 -16px 60px rgba(0,0,0,0.52);
      display: flex; flex-direction: column; overflow: hidden; flex: 1;
    }
    body.light .panel-inner { box-shadow: 0 -6px 30px rgba(13,27,62,0.14); }

    .panel-handle-row { display: flex; justify-content: center; padding: 12px 0 6px; flex-shrink: 0; }
    .panel-handle { width: 38px; height: 4px; border-radius: 2px; background: var(--border); }

    .panel-hero { height: 104px; position: relative; overflow: hidden; flex-shrink: 0; }
    .panel-hero-bg { position: absolute; inset: 0; }
    .panel-hero-pattern {
      position: absolute; inset: 0;
      background-image: radial-gradient(circle, rgba(255,255,255,0.045) 1px, transparent 1px);
      background-size: 22px 22px;
    }
    .panel-hero-content { position: absolute; inset: 0; padding: 14px 18px; display: flex; flex-direction: column; justify-content: flex-end; }
    .panel-badge { display: inline-flex; align-items: center; gap: 5px; padding: 3px 10px; border-radius: 50px; font-size: 10px; font-weight: 700; letter-spacing: 0.05em; text-transform: uppercase; margin-bottom: 6px; width: fit-content; color: var(--text-on-brand); }
    .panel-name   { font-family: 'Playfair Display', serif; font-size: 20px; font-weight: 700; color: var(--text-on-brand); line-height: 1.1; }
    .panel-common { font-size: 12px; color: rgba(255,255,255,0.55); margin-top: 3px; }

    .panel-close {
      position: absolute; top: 12px; right: 14px; width: 30px; height: 30px; border-radius: 50%; border: none;
      background: rgba(0,0,0,0.28); color: var(--text-on-brand); cursor: pointer; display: grid; place-items: center; z-index: 5; transition: background 0.18s;
    }
    .panel-close:hover { background: rgba(0,0,0,0.48); }
    .panel-close svg { width: 14px; height: 14px; fill: none; stroke: currentColor; stroke-width: 2.5; stroke-linecap: round; }

    .panel-body { overflow-y: auto; flex: 1; padding: 16px 18px 28px; -webkit-overflow-scrolling: touch; }
    .panel-body::-webkit-scrollbar { width: 4px; }
    .panel-body::-webkit-scrollbar-track { background: transparent; }
    .panel-body::-webkit-scrollbar-thumb { background: var(--scroll-thumb); border-radius: 2px; }

    .panel-tabs { display: flex; gap: 4px; margin-bottom: 16px; background: var(--surface-alt); padding: 4px; border-radius: 10px; }
    .tab-btn { flex: 1; padding: 8px; border: none; cursor: pointer; border-radius: 7px; font-family: 'DM Sans', sans-serif; font-size: 12px; font-weight: 600; color: var(--panel-tab-text); background: transparent; transition: background 0.2s, color 0.2s; }
    .tab-btn.active { background: var(--panel-tab-active); color: var(--panel-tab-active-text); }
    .tab-panel { display: none; }
    .tab-panel.active { display: block; }

    .info-section { margin-bottom: 16px; }
    .info-label { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em; color: var(--gold); margin-bottom: 6px; }
    .info-text  { font-size: 13.5px; color: var(--text-secondary); line-height: 1.7; }

    .student-card { background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 12px; padding: 14px; margin-bottom: 16px; }
    .student-card-header { display: flex; align-items: center; gap: 8px; font-size: 11px; font-weight: 700; color: var(--gold); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 8px; }
    .student-card-header svg { width: 14px; height: 14px; fill: none; stroke: currentColor; stroke-width: 2.5; stroke-linecap: round; stroke-linejoin: round; }
    .student-card p { font-size: 13px; color: var(--text-secondary); line-height: 1.65; }

    .quick-facts { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 16px; }
    .fact-chip { background: var(--chip-bg); border: 1px solid var(--chip-border); border-radius: 10px; padding: 10px 12px; }
    .fact-chip-label { font-size: 10px; color: var(--text-muted); font-weight: 600; text-transform: uppercase; letter-spacing: 0.07em; }
    .fact-chip-value { font-size: 13px; font-weight: 600; color: var(--text-primary); margin-top: 3px; }

    .panel-actions { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .action-btn { display: flex; align-items: center; justify-content: center; gap: 8px; padding: 13px; border-radius: 12px; border: none; cursor: pointer; font-family: 'DM Sans', sans-serif; font-size: 13px; font-weight: 600; transition: opacity 0.18s, transform 0.18s; }
    .action-btn:active { transform: scale(0.96); opacity: 0.8; }
    .action-btn svg { width: 16px; height: 16px; fill: none; stroke: currentColor; stroke-width: 2.5; stroke-linecap: round; stroke-linejoin: round; }
    .action-primary   { background: var(--maroon-b); color: var(--text-on-brand); }
    .action-secondary { background: var(--surface-alt); border: 1.5px solid var(--border); color: var(--text-secondary); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       DESKTOP SIDEBAR
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    @media (min-width: 640px) {
      #panel { left: 16px; right: auto; bottom: 16px; top: 78px; width: 360px; max-height: calc(100vh - 94px); transform: translateX(-115%); transition: transform 0.38s var(--ease); }
      #panel.open { transform: translateX(0); }
      .panel-inner { border-radius: var(--radius-lg); }
      .panel-handle-row { display: none; }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       LOCATION ERROR BANNER
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #loc-error { position: absolute; bottom: 216px; left: 50%; transform: translateX(-50%) translateY(24px); z-index: 960; max-width: 320px; width: calc(100% - 40px); background: var(--err-bg); border: 1.5px solid var(--err-border); color: var(--err-text); padding: 14px 18px; border-radius: var(--radius); font-size: 13px; line-height: 1.58; box-shadow: var(--shadow-lg); opacity: 0; pointer-events: none; transition: opacity 0.32s, transform 0.32s; text-align: center; }
    #loc-error.show { opacity: 1; transform: translateX(-50%) translateY(0); pointer-events: all; }
    #loc-error-close { display: inline-block; margin-top: 9px; font-size: 11px; font-weight: 700; cursor: pointer; color: var(--gold); text-transform: uppercase; letter-spacing: 0.07em; }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TOAST
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    #toast { position: absolute; bottom: 216px; left: 50%; transform: translateX(-50%) translateY(16px); z-index: 961; background: var(--toast-bg); color: var(--toast-text); padding: 10px 20px; border-radius: 50px; font-size: 13px; font-weight: 500; border: 1px solid var(--toast-border); box-shadow: var(--shadow); opacity: 0; pointer-events: none; white-space: nowrap; max-width: calc(100vw - 40px); overflow: hidden; text-overflow: ellipsis; transition: opacity 0.28s, transform 0.28s; }
    #toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
  </style>
</head>
<body>

<div id="map"></div>

<!-- ADMIN BADGE -->
<div id="admin-badge">
  <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M12 1v4M12 19v4M4.22 4.22l2.83 2.83M16.95 16.95l2.83 2.83M1 12h4M19 12h4M4.22 19.78l2.83-2.83M16.95 7.05l2.83-2.83"/></svg>
  <span id="admin-badge-text">Admin Mode â€” Click map to copy coords</span>
</div>

<!-- HEADER -->
<div id="header">
  <div class="header-row">
    <div class="logo">
      <span class="logo-mark">ğŸ—º</span>
      <div>
        <div class="logo-text">BUK Nav</div>
        <div class="logo-sub" data-i18n="oldSite">Old Site</div>
      </div>
    </div>
    <div class="search-wrap">
      <input type="text" id="search-input" autocomplete="off" spellcheck="false" />
      <div class="search-icon"><svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg></div>
      <div id="search-results"></div>
    </div>
    <div class="hdr-btns">
      <button class="hdr-btn" id="lang-btn" aria-label="Toggle language">
        <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
        <span id="lang-label">HA</span>
      </button>
      <button class="hdr-btn" id="theme-btn" aria-label="Toggle theme">
        <svg id="theme-icon" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
      </button>
    </div>
  </div>
</div>

<!-- LEGEND -->
<div id="legend">
  <div class="legend-title" data-i18n="mapGuide">Map Guide</div>
  <div class="legend-row"><div class="lg-poly"></div><span data-i18n="lgBuilding">Building</span></div>
  <div class="legend-row"><div class="lg-poly-active"></div><span data-i18n="lgSelected">Selected</span></div>
  <div class="legend-row"><div class="lg-dot-blue"></div><span data-i18n="lgYouAreHere">You are here</span></div>
  <div class="lg-zoom-hint" id="zoom-hint">
    <svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/><line x1="11" y1="8" x2="11" y2="14"/><line x1="8" y1="11" x2="14" y2="11"/></svg>
    <span data-i18n="lgZoomHint">Zoom in for labels</span>
  </div>
</div>

<!-- FLOATING CONTROLS -->
<div id="controls">
  <button class="ctrl-btn" id="btn-zi" aria-label="Zoom in">
    <svg viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
  </button>
  <button class="ctrl-btn" id="btn-zo" aria-label="Zoom out">
    <svg viewBox="0 0 24 24"><line x1="5" y1="12" x2="19" y2="12"/></svg>
  </button>
  <button class="ctrl-btn" id="btn-center" aria-label="Centre on BUK">
    <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="9"/><line x1="12" y1="1" x2="12" y2="5"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="1" y1="12" x2="5" y2="12"/><line x1="19" y1="12" x2="23" y2="12"/><circle cx="12" cy="12" r="2" fill="currentColor" stroke="none"/></svg>
  </button>
  <button class="ctrl-btn" id="btn-locate" aria-label="Locate me">
    <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M12 2v3M12 19v3M2 12h3M19 12h3"/><circle cx="12" cy="12" r="8" stroke-dasharray="3 2"/></svg>
  </button>
</div>

<!-- PANEL -->
<div id="panel">
  <div class="panel-inner">
    <div class="panel-handle-row"><div class="panel-handle"></div></div>
    <div class="panel-hero">
      <div class="panel-hero-bg" id="panel-hero-bg"></div>
      <div class="panel-hero-pattern"></div>
      <div class="panel-hero-content">
        <div class="panel-badge"  id="panel-badge"></div>
        <div class="panel-name"   id="panel-name"></div>
        <div class="panel-common" id="panel-common"></div>
      </div>
      <button class="panel-close" id="panel-close" aria-label="Close">
        <svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
    </div>
    <div class="panel-body">
      <div class="panel-tabs">
        <button class="tab-btn active" data-tab="info"  data-i18n="tabInfo">About</button>
        <button class="tab-btn"        data-tab="tips"  data-i18n="tabTips">Student Tips</button>
        <button class="tab-btn"        data-tab="facts" data-i18n="tabFacts">Quick Facts</button>
      </div>
      <div class="tab-panel active" id="tab-info">
        <div class="info-section">
          <div class="info-label" data-i18n="labelDesc">Description</div>
          <div class="info-text" id="panel-desc"></div>
        </div>
        <div class="panel-actions">
          <button class="action-btn action-primary"   id="btn-navigate"><svg viewBox="0 0 24 24"><polygon points="3 11 22 2 13 21 11 13 3 11"/></svg><span data-i18n="navigate">Navigate</span></button>
          <button class="action-btn action-secondary" id="btn-share"><svg viewBox="0 0 24 24"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg><span data-i18n="share">Share</span></button>
        </div>
      </div>
      <div class="tab-panel" id="tab-tips">
        <div class="student-card">
          <div class="student-card-header">
            <svg viewBox="0 0 24 24"><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 3 9 3 12 0v-5"/></svg>
            <span data-i18n="studentTip">Student Tip</span>
          </div>
          <p id="panel-students"></p>
        </div>
        <div class="panel-actions">
          <button class="action-btn action-primary"   id="btn-navigate2"><svg viewBox="0 0 24 24"><polygon points="3 11 22 2 13 21 11 13 3 11"/></svg><span data-i18n="navigate">Navigate</span></button>
          <button class="action-btn action-secondary" id="btn-save"><svg viewBox="0 0 24 24"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/></svg><span data-i18n="save">Save</span></button>
        </div>
      </div>
      <div class="tab-panel" id="tab-facts">
        <div class="quick-facts" id="panel-facts"></div>
        <div class="panel-actions" style="margin-top:4px">
          <button class="action-btn action-primary"   id="btn-navigate3"><svg viewBox="0 0 24 24"><polygon points="3 11 22 2 13 21 11 13 3 11"/></svg><span data-i18n="navigate">Navigate</span></button>
          <button class="action-btn action-secondary" id="btn-share2"><svg viewBox="0 0 24 24"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg><span data-i18n="share">Share</span></button>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="loc-error" role="alert">
  <div id="loc-error-msg"></div>
  <div id="loc-error-close" role="button" tabindex="0" data-i18n="dismiss">Dismiss</div>
</div>
<div id="toast" role="status" aria-live="polite"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/7.0.0/fuse.min.js"></script>
<script>
'use strict';

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   i18n
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const translations = {
  en: {
    oldSite:'Old Site', searchPlaceholder:'Search buildings, facultiesâ€¦',
    mapGuide:'Map Guide', lgBuilding:'Building', lgSelected:'Selected',
    lgYouAreHere:'You are here', lgZoomHint:'Zoom in for labels',
    tabInfo:'About', tabTips:'Student Tips', tabFacts:'Quick Facts',
    labelDesc:'Description', navigate:'Navigate', share:'Share', save:'Save',
    studentTip:'Student Tip',
    locating:'Searching for your locationâ€¦',
    locationFound:'ğŸ“ You are here!',
    locationUpdated:'Position updated.',
    trackingOff:'Live tracking stopped.',
    centerDone:'Centred on BUK Old Site.',
    navSoon:'GPS routing coming in v5!',
    shareDone:'Link copied to clipboard!',
    saveDone:'Location bookmarked!',
    dismiss:'Dismiss', noResults:'No buildings found. Try a different spelling.',
    coordCopied:'ğŸ“‹ Copied:',
    adminBadge:'Admin Mode â€” Click map to copy coords',
    errDenied:'Location access denied. Enable permissions in browser settings.',
    errUnavailable:'Location unavailable. Make sure GPS is enabled.',
    errTimeout:'Location timed out. Please try again.',
    errUnsupported:'Your browser does not support geolocation.',
  },
  ha: {
    oldSite:'Tsohon Wurin', searchPlaceholder:'Nemo gini, azuzuwanâ€¦',
    mapGuide:'Jagorar Taswira', lgBuilding:'Gini', lgSelected:'An ZaÉ“a',
    lgYouAreHere:'Kana nan', lgZoomHint:'Gabbato don alamomi',
    tabInfo:'Bayani', tabTips:'Nasihar Dalibi', tabFacts:'Bayanai GabaÉ—aya',
    labelDesc:'Bayanin Wuri', navigate:'Bi Hanya', share:'Raba', save:'Ajiye',
    studentTip:'Nasihar Dalibi',
    locating:'Ana nemo wurinkaâ€¦',
    locationFound:'ğŸ“ Kana nan!',
    locationUpdated:'An sabunta matsayinka.',
    trackingOff:'An dakatar da bin wuri.',
    centerDone:'An dawo tsakiyar BUK.',
    navSoon:'Jagoran GPS zai zo a v5!',
    shareDone:'An kwafi hanyar!',
    saveDone:'An ajiye wuri!',
    dismiss:'Rufe', noResults:'Ba a sami gini ba. Gwada rubutu daban.',
    coordCopied:'ğŸ“‹ An kwafi:',
    adminBadge:'Yanayin Admin â€” Latsa taswira don kwafi maki',
    errDenied:'An hana damar wuri. Yarda da dama a saitunan browser.',
    errUnavailable:'Ba a sami wurinka ba. Tabbatar GPS yana aiki.',
    errTimeout:'BuÆ™atar wuri ta É—auki lokaci. Sake gwadawa.',
    errUnsupported:'Browser É—inka baya goyan bayan geolocation.',
  }
};
let currentLang = 'en';
const t = k => translations[currentLang][k] ?? translations.en[k] ?? k;
function applyTranslations() {
  document.querySelectorAll('[data-i18n]').forEach(el => { el.textContent = t(el.dataset.i18n); });
  document.getElementById('search-input').placeholder = t('searchPlaceholder');
  document.getElementById('lang-label').textContent   = currentLang === 'en' ? 'HA' : 'EN';
  document.getElementById('admin-badge-text').textContent = t('adminBadge');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LANDMARK DATA
   â€” Panel info, entrance marker coords, label coords
   â€” entranceCoord: where the elegant dot pin appears
   â€” labelCoord:    where the zoom-gated text label sits
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const bukLandmarks = [
  {
    id:'fais', category:'Faculty', emoji:'ğŸ“š', color:'#c9973a',
    heroBg:'linear-gradient(135deg,#7a5a1a,#1e3168)',
    name_en:'Faculty of Arts & Islamic Studies', name_ha:'Fakaltun Fasaha da Karatun Musulunci',
    commonName_en:'FAIS Building', commonName_ha:'Ginin FAIS',
    desc_en:'Home to departments of Arabic, Islamic Studies, History, and English Language. One of BUK\'s oldest faculties, known for its landmark arched entrance and serene courtyard.',
    desc_ha:'Cibiyar dakunan karantar Larabci, Karatun Musulunci, Tarihi, da Turanci. ÆŠaya daga cikin tsofaffin azuzuwan BUK, sananne don Æ™ofofinsa masu kama da baka.',
    students_en:'Exit through the east door for a 3-min shortcut to the Main Library. Timetable boards posted at the main archway every Monday morning.',
    students_ha:'Fita ta Æ™ofar gabas don hanyar gajere zuwa Babban Dakin Karatu â€” minti 3. Ana É—ora jadawalin darussa kowace Litinin safe.',
    facts:{ en:[{label:'Founded',value:'1977'},{label:'Departments',value:'6'},{label:'Category',value:'Faculty'},{label:'Zone',value:'North Block'}], ha:[{label:'An Kafa',value:'1977'},{label:'Sassan Karatu',value:'6'},{label:'Nau\'i',value:'Azuzuwan'},{label:'Yanki',value:'Arewacin Ginin'}] },
    /* south-centre of the placeholder rectangle */
    entranceCoord: { lat:11.98135, lng:8.47400 },
    labelCoord:    [ 11.9815,  8.47400 ]
  },
  {
    id:'convo', category:'Theater', emoji:'ğŸ“', color:'#a8293e',
    heroBg:'linear-gradient(135deg,#7b1d2e,#0d1b3e)',
    name_en:'Convocation Arena', name_ha:'Filin Bikin Kammala Karatu',
    commonName_en:'The Convo', commonName_ha:'Filin Bikin',
    desc_en:'The grand outdoor arena serving as BUK\'s ceremonial heart. Hosts annual convocation, presidential visits, public lectures, and inter-faculty competitions.',
    desc_ha:'Babban filin waje zuciyar bikin BUK. Ana yin bikin kammala karatu, ziyarori na shugabanci, lacca na jama\'a da gasar azuzuwa a nan.',
    students_en:'Arrive 45 min early for convocation â€” parking fills fast. The east entrance has shorter queues than the main gate.',
    students_ha:'Zo minti 45 kafin bikin â€” wurin ajiye mota yana cika da wuri. Æ˜ofar gabas tana da É—an gajeren jerin mutane.',
    facts:{ en:[{label:'Capacity',value:'~5,000'},{label:'Type',value:'Outdoor Arena'},{label:'Category',value:'Theater'},{label:'Zone',value:'Central'}], ha:[{label:'Iya KarÉ“a',value:'~5,000'},{label:'Nau\'i',value:'Filin Waje'},{label:'Nau\'in',value:'Filin Taro'},{label:'Yanki',value:'Tsakiya'}] },
    entranceCoord: { lat:11.97975, lng:8.47610 },
    labelCoord:    [ 11.98000, 8.47610 ]
  },
  {
    id:'library', category:'Library', emoji:'ğŸ“–', color:'#1e88e5',
    heroBg:'linear-gradient(135deg,#1565c0,#162348)',
    name_en:'Central Library', name_ha:'Babban Dakin Karatu',
    commonName_en:'The Main Library', commonName_ha:'Babban Laburare',
    desc_en:'A multi-storey academic library housing thousands of volumes, bound journals, research theses, and digital resources. The primary research hub for all BUK students.',
    desc_ha:'Laburaren ilimi mai hawa da yawa wanda ke É—auke da dubban littattafai, jaridu, da albarkatu na dijital.',
    students_en:'Bring your student ID â€” required for access. 2nd floor has the quietest reading area. Printing â‚¦10/page. Open 8 AM â€“ 9 PM.',
    students_ha:'Kawo katin dalibinka â€” ana buÆ™atarsa. Hawa na 2 yana mafi natsuwa. Buga takarda â‚¦10/shafi. Bude 8 AM â€“ 9 PM.',
    facts:{ en:[{label:'Floors',value:'4'},{label:'Open',value:'8 AM â€“ 9 PM'},{label:'Category',value:'Library'},{label:'Zone',value:'West Block'}], ha:[{label:'Hawa',value:'4'},{label:'BuÉ—ewa',value:'8 AM â€“ 9 PM'},{label:'Nau\'i',value:'Dakin Karatu'},{label:'Yanki',value:'Yammacin Ginin'}] },
    entranceCoord: { lat:11.97930, lng:8.47305 },
    labelCoord:    [ 11.97948, 8.47305 ]
  },
  {
    id:'sms', category:'Faculty', emoji:'ğŸ›', color:'#c9973a',
    heroBg:'linear-gradient(135deg,#7a5a1a,#1e3168)',
    name_en:'Faculty of Social & Management Sciences', name_ha:'Fakaltun Kimiyyar Zamantakewa da Gudanarwa',
    commonName_en:'SMS Faculty', commonName_ha:'Fakaltun SMS',
    desc_en:'Hosts Economics, Business Admin, Political Science, Sociology, and Mass Comm departments. Modern multi-level lecture complex with a dedicated postgraduate wing.',
    desc_ha:'Cibiyar dakunan karantar Tattalin Arziki, Gudanar da Kasuwanci, Kimiyyar Siyasa, Ilimin Zamantakewa, da Sadarwa ga Jama\'a.',
    students_en:'Ground floor lounge has strong WiFi, open until 10 PM â€” ideal for group work. Check Dean\'s notice board for scholarship updates.',
    students_ha:'Zaure a hawa na farko yana da Æ™arfin WiFi â€” buÉ—e har 10 dare. Duba allon Dean don tallafi.',
    facts:{ en:[{label:'Founded',value:'1981'},{label:'Departments',value:'5'},{label:'Category',value:'Faculty'},{label:'Zone',value:'East Block'}], ha:[{label:'An Kafa',value:'1981'},{label:'Sassan Karatu',value:'5'},{label:'Nau\'i',value:'Azuzuwan'},{label:'Yanki',value:'Gabashin Ginin'}] },
    entranceCoord: { lat:11.98170, lng:8.47820 },
    labelCoord:    [ 11.98200, 8.47820 ]
  },
  {
    id:'vc', category:'Office', emoji:'ğŸ¢', color:'#388e3c',
    heroBg:'linear-gradient(135deg,#2e6b31,#162348)',
    name_en:'Vice Chancellor\'s Office', name_ha:'Ofishin Mataimakin Shugaban Jami\'a',
    commonName_en:'VC\'s Lodge', commonName_ha:'Ofishin VC',
    desc_en:'Central administrative nucleus of Bayero University Kano. Houses the VC, Deputy VCs, Registrar, and key management offices. Surrounded by manicured grounds.',
    desc_ha:'Cibiyar gudanarwa ta Jami\'ar Bayero Kano. Ofishin Mataimakin Shugaban Jami\'a, Mataimakai, da manyan ofisoshin gudanarwa suna nan.',
    students_en:'Admin queries (transcripts, deferral, bursary) at ground floor helpdesk. Best visited 9â€“11 AM. Smart dress expected.',
    students_ha:'Ana magance tambayoyin gudanarwa a tebur na taimako. Mafi kyau 9â€“11 safe. Ana tsammani sutura mai kyau.',
    facts:{ en:[{label:'Type',value:'Administration'},{label:'Hours',value:'8 AM â€“ 4 PM'},{label:'Category',value:'Office'},{label:'Zone',value:'Central'}], ha:[{label:'Nau\'i',value:'Gudanarwa'},{label:'Sa\'o\'i',value:'8 AM â€“ 4 PM'},{label:'Nau\'in',value:'Ofis'},{label:'Yanki',value:'Tsakiya'}] },
    entranceCoord: { lat:11.98062, lng:8.47488 },
    labelCoord:    [ 11.98079, 8.47488 ]
  }
];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUILDING FOOTPRINTS â€” Polygons
   â€” landmarkId links to bukLandmarks[].id
   â€” latlngs: placeholder rectangles; replace with
     Admin Mode (?edit=true) for precise outlines
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const bukStructures = [
  { id:'poly-fais',    landmarkId:'fais',    latlngs:[ [11.98165,8.47375],[11.98165,8.47425],[11.98135,8.47425],[11.98135,8.47375] ] },
  { id:'poly-convo',   landmarkId:'convo',   latlngs:[ [11.98025,8.47565],[11.98025,8.47655],[11.97975,8.47655],[11.97975,8.47565] ] },
  { id:'poly-library', landmarkId:'library', latlngs:[ [11.97965,8.47265],[11.97965,8.47345],[11.97930,8.47345],[11.97930,8.47265] ] },
  { id:'poly-sms',     landmarkId:'sms',     latlngs:[ [11.98230,8.47775],[11.98230,8.47865],[11.98170,8.47865],[11.98170,8.47775] ] },
  { id:'poly-vc',      landmarkId:'vc',      latlngs:[ [11.98095,8.47455],[11.98095,8.47520],[11.98062,8.47520],[11.98062,8.47455] ] }
];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FUSE.JS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buildFuse() {
  return new Fuse(
    bukLandmarks.map(l=>({id:l.id,name_en:l.name_en,name_ha:l.name_ha,common_en:l.commonName_en,common_ha:l.commonName_ha,category:l.category})),
    {threshold:0.4,includeScore:true,keys:[{name:'name_en',weight:0.35},{name:'name_ha',weight:0.35},{name:'common_en',weight:0.15},{name:'common_ha',weight:0.15},{name:'category',weight:0.10}]}
  );
}
let fuse = buildFuse();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const BUK_CENTER  = [11.9808, 8.4755];
const BUK_ZOOM    = 17;
const LABEL_ZOOM  = 16;  /* labels appear at this zoom and above */

const map = L.map('map', {center:BUK_CENTER, zoom:BUK_ZOOM, zoomControl:false});

const darkTiles  = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png',         {attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OSM</a> &copy; <a href="https://carto.com/">CARTO</a>',subdomains:'abcd',maxZoom:20}).addTo(map);
const lightTiles = L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png',{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OSM</a> &copy; <a href="https://carto.com/">CARTO</a>',subdomains:'abcd',maxZoom:20});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   POLYGON STYLE SYSTEM (Task 1)
   Three states: idle â†’ hover â†’ active
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   idle   â€” barely-there dashed outline, near-0 fill
   hover  â€” solid outline, gentle fill
   active â€” thick gold border, richer fill, no dash
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function polyIdle(color) {
  return { color, fillColor:color, fillOpacity:0.04, opacity:0.30, weight:1.5, dashArray:'5 4', lineJoin:'round' };
}
function polyHover(color) {
  return { color, fillColor:color, fillOpacity:0.16, opacity:0.80, weight:2,   dashArray:null,  lineJoin:'round' };
}
function polyActive(color) {
  return { color:'#c9973a', fillColor:color, fillOpacity:0.26, opacity:1,    weight:3,   dashArray:null,  lineJoin:'round' };
}

/* Inject tooltip CSS */
const _ttCSS = document.createElement('style');
_ttCSS.textContent = `.buk-tt{background:var(--surface)!important;border:1.5px solid var(--border)!important;color:var(--text-primary)!important;border-radius:9px!important;padding:5px 12px!important;box-shadow:var(--shadow)!important;font-family:'DM Sans',sans-serif;font-size:12px;font-weight:600;pointer-events:none}.buk-tt::before{display:none!important}`;
document.head.appendChild(_ttCSS);

/* Build polygons â€” no teardrop markers, polygons are the primary affordance */
let activeId   = null;   /* currently activated landmark id */
let activeMarker = null; /* single entrance/search marker instance */

const polyLayers = [];   /* { poly, landmark } */

bukStructures.forEach(s => {
  const lm = bukLandmarks.find(x => x.id === s.landmarkId);
  if (!lm) return;

  const poly = L.polygon(s.latlngs, polyIdle(lm.color)).addTo(map);

  /* Tooltip on hover â€” short common name */
  const tooltipName = () => currentLang === 'en' ? lm.commonName_en : lm.commonName_ha;
  poly.bindTooltip(tooltipName(), {sticky:true, className:'buk-tt', opacity:1});

  /* Mouse events â€” hover state (desktop) */
  poly.on('mouseover', () => {
    if (activeId !== lm.id) poly.setStyle(polyHover(lm.color));
    poly.setTooltipContent(tooltipName());
  });
  poly.on('mouseout', () => {
    if (activeId !== lm.id) poly.setStyle(polyIdle(lm.color));
  });

  /* Click â€” activate building */
  poly.on('click', e => {
    L.DomEvent.stopPropagation(e);
    activateBuilding(lm, 'click');
  });

  polyLayers.push({poly, landmark:lm});
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ENTRANCE DOT ICON â€” elegant small pin (Task 1)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function entranceDotIcon(color) {
  return L.divIcon({
    html: `<div class="entrance-dot" style="background:${color}"></div>`,
    className: '', iconSize:[11,11], iconAnchor:[5,5]
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SEARCH PULSE ICON â€” gold ring marker (Task 3)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function searchPulseIcon(color) {
  return L.divIcon({
    html: `<div class="sp-wrap">
             <div class="sp-ring" style="background:${color}33"></div>
             <div class="sp-core" style="background:${color}"></div>
           </div>`,
    className: '', iconSize:[18,18], iconAnchor:[9,9]
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ACTIVATE / DEACTIVATE BUILDING (Tasks 1 & 3)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   source = 'click' â†’ static entrance dot
   source = 'search' â†’ pulsing gold ring marker
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function activateBuilding(lm, source) {
  /* Deactivate previous silently */
  _deactivateCurrentPoly();

  activeId = lm.id;

  /* Highlight polygon */
  const entry = polyLayers.find(p => p.landmark.id === lm.id);
  if (entry) entry.poly.setStyle(polyActive(lm.color));

  /* Place entrance / search marker */
  if (activeMarker) { map.removeLayer(activeMarker); activeMarker = null; }
  const coord = [lm.entranceCoord.lat, lm.entranceCoord.lng];
  const icon  = source === 'search' ? searchPulseIcon(lm.color) : entranceDotIcon(lm.color);
  activeMarker = L.marker(coord, {icon, zIndexOffset:600, interactive:false}).addTo(map);

  /* Open panel */
  populatePanel(lm);
  setTab('info');
  panel.classList.add('open');

  /* Fly to entrance â€” zoom 18 so label is visible */
  map.flyTo(coord, Math.max(map.getZoom(), 18), {duration:0.80});
}

function _deactivateCurrentPoly() {
  if (!activeId) return;
  const entry = polyLayers.find(p => p.landmark.id === activeId);
  if (entry) entry.poly.setStyle(polyIdle(entry.landmark.color));
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ZOOM-DEPENDENT LABELS (Task 2)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Labels live in a LayerGroup. On zoomend, the
   group is added/removed based on zoom >= LABEL_ZOOM.
   CSS opacity transition makes them fade in/out.
   Body.light class flips text/halo colours.
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const labelGroup = L.layerGroup();
const labelDivs  = [];   /* track DOM elements for rebuild */

function buildLabels() {
  labelGroup.clearLayers();
  labelDivs.length = 0;

  bukLandmarks.forEach(lm => {
    const text = currentLang === 'en' ? lm.commonName_en : lm.commonName_ha;
    const div  = document.createElement('div');
    div.className = 'buk-label';
    div.textContent = text;

    const icon = L.divIcon({
      html:      div,
      className: 'buk-label-wrap',
      iconSize:  null,
      iconAnchor:[0, 0]
    });

    L.marker(lm.labelCoord, {icon, interactive:false, zIndexOffset:-200}).addTo(labelGroup);
    labelDivs.push(div);
  });
}

function setLabelsVisible(visible) {
  /* CSS transition â€” batch-toggle class on all label divs */
  labelDivs.forEach(d => d.classList.toggle('visible', visible));
}

function updateLabelVisibility() {
  const shouldShow = map.getZoom() >= LABEL_ZOOM;
  const alreadyOn  = map.hasLayer(labelGroup);

  /* Update legend hint */
  document.getElementById('zoom-hint').style.display = shouldShow ? 'none' : 'flex';

  if (shouldShow && !alreadyOn) {
    labelGroup.addTo(map);
    /* Small delay so elements are in DOM before transition fires */
    requestAnimationFrame(() => requestAnimationFrame(() => setLabelsVisible(true)));
  } else if (!shouldShow && alreadyOn) {
    setLabelsVisible(false);
    /* Remove group after transition completes */
    setTimeout(() => { if (map.getZoom() < LABEL_ZOOM) map.removeLayer(labelGroup); }, 380);
  }
}

map.on('zoomend', updateLabelVisibility);

buildLabels();
/* Initial state â€” start at zoom 17 so labels show immediately */
labelGroup.addTo(map);
requestAnimationFrame(() => requestAnimationFrame(() => setLabelsVisible(true)));
document.getElementById('zoom-hint').style.display = 'none';

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ADMIN MODE â€” Coordinate Picker (?edit=true)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const ADMIN_MODE = new URLSearchParams(window.location.search).get('edit') === 'true';

if (ADMIN_MODE) {
  document.body.classList.add('admin-mode');
  document.getElementById('admin-badge').classList.add('visible');
  let adminPin = null;

  map.on('click', e => {
    const lat = e.latlng.lat.toFixed(6);
    const lng = e.latlng.lng.toFixed(6);
    const coord = `[${lat}, ${lng}]`;
    const icon  = L.divIcon({html:'<div class="admin-pin"></div>',className:'',iconSize:[12,12],iconAnchor:[6,6]});
    if (adminPin) map.removeLayer(adminPin);
    adminPin = L.marker([e.latlng.lat,e.latlng.lng],{icon,zIndexOffset:2000}).addTo(map);
    navigator.clipboard.writeText(coord).catch(()=>{});
    showToast(`${t('coordCopied')} ${coord}`);
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LIVE LOCATION â€” Blue Dot (only permanent marker)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let blueDot=null, accCircle=null, watchId=null, firstFix=true;

function blueDotIcon() {
  return L.divIcon({html:`<div class="bd-wrap"><div class="bd-ring"></div><div class="bd-core"></div></div>`,className:'',iconSize:[20,20],iconAnchor:[10,10]});
}
function onPosition(pos) {
  const {latitude:lat,longitude:lng,accuracy}=pos.coords;
  if (!blueDot) {
    blueDot   = L.marker([lat,lng],{icon:blueDotIcon(),zIndexOffset:1000}).addTo(map);
    accCircle = L.circle([lat,lng],{radius:accuracy,color:'#1976d2',fillColor:'#1976d2',fillOpacity:0.08,weight:1.5,dashArray:'5 4'}).addTo(map);
  } else { blueDot.setLatLng([lat,lng]); accCircle.setLatLng([lat,lng]); accCircle.setRadius(accuracy); }
  if (firstFix) { map.flyTo([lat,lng],18,{duration:1.1}); showToast(t('locationFound')); firstFix=false; }
  else showToast(t('locationUpdated'));
}
function onPositionError(err) {
  showLocError(t({1:'errDenied',2:'errUnavailable',3:'errTimeout'}[err.code]||'errUnavailable'));
  stopTracking();
}
function startTracking() {
  if (!navigator.geolocation) { showLocError(t('errUnsupported')); return; }
  firstFix=true; showToast(t('locating'));
  document.getElementById('btn-locate').classList.add('tracking');
  watchId=navigator.geolocation.watchPosition(onPosition,onPositionError,{enableHighAccuracy:true,timeout:12000,maximumAge:3000});
}
function stopTracking() {
  if (watchId!==null) { navigator.geolocation.clearWatch(watchId); watchId=null; }
  document.getElementById('btn-locate').classList.remove('tracking');
}
document.getElementById('btn-locate').addEventListener('click',()=>{
  if (watchId!==null) { stopTracking(); showToast(t('trackingOff')); } else startTracking();
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CENTRE MAP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.getElementById('btn-center').addEventListener('click',()=>{ map.flyTo(BUK_CENTER,BUK_ZOOM,{duration:0.9}); showToast(t('centerDone')); });

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOCATION ERROR BANNER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let errTimer;
function showLocError(msg) {
  const b=document.getElementById('loc-error');
  document.getElementById('loc-error-msg').textContent=msg;
  b.classList.add('show');
  clearTimeout(errTimer);
  errTimer=setTimeout(()=>b.classList.remove('show'),9000);
}
document.getElementById('loc-error-close').addEventListener('click',()=>document.getElementById('loc-error').classList.remove('show'));
document.getElementById('loc-error-close').addEventListener('keydown',e=>{if(e.key==='Enter'||e.key===' ')document.getElementById('loc-error').classList.remove('show');});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PANEL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const panel = document.getElementById('panel');

function populatePanel(lm) {
  const lg = currentLang;
  document.getElementById('panel-name').textContent     = lg==='en'?lm.name_en:lm.name_ha;
  document.getElementById('panel-common').textContent   = lg==='en'?lm.commonName_en:lm.commonName_ha;
  document.getElementById('panel-desc').textContent     = lg==='en'?lm.desc_en:lm.desc_ha;
  document.getElementById('panel-students').textContent = lg==='en'?lm.students_en:lm.students_ha;
  const badge=document.getElementById('panel-badge');
  badge.textContent  =`${lm.emoji}  ${t('cat'+lm.category)||lm.category}`;
  badge.style.cssText=`background:${lm.color}28;color:#fff;border:1px solid ${lm.color}70;`;
  document.getElementById('panel-hero-bg').style.background=lm.heroBg;
  const facts=lm.facts[lg]||lm.facts.en;
  document.getElementById('panel-facts').innerHTML=facts.map(f=>`<div class="fact-chip"><div class="fact-chip-label">${f.label}</div><div class="fact-chip-value">${f.value}</div></div>`).join('');
}

function updatePanelText() {
  if (!activeId) return;
  const lm = bukLandmarks.find(x=>x.id===activeId);
  if (lm) populatePanel(lm);
  /* Refresh tooltip text for all polys */
  polyLayers.forEach(({poly,landmark:l})=>{
    poly.setTooltipContent(currentLang==='en'?l.commonName_en:l.commonName_ha);
  });
}

/* closePanel â€” Task 4: map returns to 100% clean state */
function closePanel() {
  panel.classList.remove('open');
  /* Reset polygon */
  _deactivateCurrentPoly();
  activeId = null;
  /* Remove entrance/search marker â€” blue dot is the only permanent marker */
  if (activeMarker) { map.removeLayer(activeMarker); activeMarker = null; }
}

document.getElementById('panel-close').addEventListener('click', closePanel);
/* Map background click closes panel (unless in admin mode) */
if (!ADMIN_MODE) {
  map.on('click', () => {
    if (panel.classList.contains('open')) closePanel();
  });
}

function setTab(n) {
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.toggle('active',b.dataset.tab===n));
  document.querySelectorAll('.tab-panel').forEach(p=>p.classList.toggle('active',p.id==='tab-'+n));
}
document.querySelectorAll('.tab-btn').forEach(btn=>btn.addEventListener('click',()=>setTab(btn.dataset.tab)));

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SEARCH
   â€” On result click: activateBuilding with source='search'
     which drops the gold pulsing ring (Task 3)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const searchInput = document.getElementById('search-input');
const searchBox   = document.getElementById('search-results');

searchInput.addEventListener('input', () => {
  const q = searchInput.value.trim();
  searchBox.innerHTML = '';
  if (!q) { searchBox.classList.remove('open'); return; }
  const results = fuse.search(q).slice(0,6);
  if (!results.length) {
    searchBox.innerHTML=`<div class="sr-empty">${t('noResults')}</div>`;
    searchBox.classList.add('open'); return;
  }
  results.forEach(({item,score}) => {
    const lm = bukLandmarks.find(x=>x.id===item.id); if(!lm) return;
    const name   = currentLang==='en'?lm.name_en:lm.name_ha;
    const common = currentLang==='en'?lm.commonName_en:lm.commonName_ha;
    const pct    = Math.round((1-score)*100);
    const div = document.createElement('div');
    div.className = 'sr-item';
    div.innerHTML = `<div class="sr-icon" style="background:${lm.color}1e;font-size:18px">${lm.emoji}</div><div style="flex:1;min-width:0"><div class="sr-name">${name}</div><div class="sr-meta">${lm.category} Â· ${common}</div></div><div class="sr-score">${pct}%</div>`;
    div.addEventListener('click', () => {
      searchInput.value = name;
      searchBox.classList.remove('open');
      activateBuilding(lm, 'search');  /* â† gold pulse marker */
    });
    searchBox.appendChild(div);
  });
  searchBox.classList.add('open');
});

document.addEventListener('click', e => {
  if (!searchInput.contains(e.target) && !searchBox.contains(e.target)) searchBox.classList.remove('open');
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LANGUAGE TOGGLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.getElementById('lang-btn').addEventListener('click', () => {
  currentLang = currentLang==='en'?'ha':'en';
  applyTranslations();
  updatePanelText();
  fuse = buildFuse();
  searchInput.value = '';
  searchBox.classList.remove('open');
  /* Rebuild labels in new language */
  buildLabels();
  if (map.getZoom() >= LABEL_ZOOM) {
    labelGroup.addTo(map);
    requestAnimationFrame(() => requestAnimationFrame(() => setLabelsVisible(true)));
  }
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   THEME TOGGLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let isLight = false;
const themeIcon = document.getElementById('theme-icon');
const SUN  = '<circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>';
const MOON = '<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>';

document.getElementById('theme-btn').addEventListener('click', () => {
  isLight = !isLight;
  document.body.classList.toggle('light', isLight);
  if (isLight) { map.removeLayer(darkTiles); lightTiles.addTo(map); themeIcon.innerHTML=SUN; }
  else         { map.removeLayer(lightTiles); darkTiles.addTo(map); themeIcon.innerHTML=MOON; }
  /* Polygon fill/stroke colors come from landmark.color (not CSS vars) so no poly refresh needed.
     Label text/halo colours are handled by body.light CSS selector automatically. */
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ZOOM CONTROLS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.getElementById('btn-zi').addEventListener('click', ()=>map.zoomIn());
document.getElementById('btn-zo').addEventListener('click', ()=>map.zoomOut());

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ACTION BUTTONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
['btn-navigate','btn-navigate2','btn-navigate3'].forEach(id=>document.getElementById(id)?.addEventListener('click',()=>showToast(t('navSoon'))));
['btn-share','btn-share2'].forEach(id=>document.getElementById(id)?.addEventListener('click',()=>{navigator.clipboard?.writeText(location.href).catch(()=>{}); showToast(t('shareDone'));}));
document.getElementById('btn-save')?.addEventListener('click',()=>showToast(t('saveDone')));

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let toastTimer;
function showToast(msg) {
  const el=document.getElementById('toast');
  el.textContent=msg; el.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer=setTimeout(()=>el.classList.remove('show'),3200);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
applyTranslations();
</script>
</body>
</html>
