<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BUK Navigate â€” Old Site</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=DM+Sans:ital,wght@0,300;0,400;0,500;0,600;1,400&display=swap" rel="stylesheet" />

  <style>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       DESIGN TOKENS â€” Dark Mode (default)
       Every colour that touches UI chrome uses a variable.
       No raw #fff / #000 inside component rules.
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    :root {
      /* Brand */
      --maroon:           #7b1d2e;
      --maroon-b:         #a8293e;
      --gold:             #c9973a;
      --gold-soft:        rgba(201,151,58,0.15);
      --gold-ring:        rgba(201,151,58,0.38);

      /* Dark surfaces (WCAG-AA charcoal palette â€” Task 4) */
      --bg:               #121212;
      --surface:          #1a1f2e;
      --surface-alt:      #232840;
      --surface-raised:   #2a3050;

      /* Dark borders / glass */
      --border:           rgba(255,255,255,0.09);
      --glass:            rgba(18,18,18,0.86);
      --header-bg:        rgba(18,18,18,0.94);

      /* Dark typography (Task 4: soft-white, not pure #fff) */
      --text-primary:     #e0e0e0;
      --text-secondary:   #9ba3b8;
      --text-on-brand:    #ffffff;   /* always white on coloured surfaces */
      --text-placeholder: rgba(224,224,224,0.38);

      /* Icon / control surfaces */
      --ctrl-bg:          rgba(26,31,46,0.92);
      --ctrl-border:      rgba(255,255,255,0.10);
      --ctrl-icon:        #e0e0e0;

      /* Search dropdown */
      --dropdown-bg:      #1a1f2e;
      --dropdown-hover:   rgba(255,255,255,0.06);
      --dropdown-div:     rgba(255,255,255,0.05);

      /* Legend */
      --legend-text:      #c4cad8;

      /* Panel */
      --panel-bg:         #1a1f2e;
      --panel-tab-active: #2a3050;
      --panel-tab-text:   #9ba3b8;
      --panel-tab-active-text: #e0e0e0;
      --chip-bg:          #232840;
      --chip-border:      rgba(255,255,255,0.07);

      /* Student card */
      --card-bg:          rgba(201,151,58,0.10);
      --card-border:      rgba(201,151,58,0.22);

      /* Toast */
      --toast-bg:         #2a3050;
      --toast-border:     rgba(255,255,255,0.10);

      /* Scrollbar */
      --scroll-thumb:     rgba(255,255,255,0.14);

      /* Map */
      --map-filter:       saturate(0.72) brightness(0.82);

      /* Misc */
      --radius:     14px;
      --radius-lg:  20px;
      --shadow:     0 8px 28px rgba(0,0,0,0.40);
      --shadow-lg:  0 20px 60px rgba(0,0,0,0.55);
      --ease:       cubic-bezier(0.4,0,0.2,1);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       LIGHT MODE â€” every token flips, no hardcodes in components
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    body.light {
      --bg:               #eef1f8;
      --surface:          #ffffff;
      --surface-alt:      #eef1f8;
      --surface-raised:   #e0e6f5;
      --border:           rgba(13,27,62,0.11);
      --glass:            rgba(240,244,255,0.93);
      --header-bg:        rgba(13,27,62,0.96);  /* navy stays dark */
      --text-primary:     #0d1b3e;
      --text-secondary:   #4a5580;
      --text-placeholder: rgba(13,27,62,0.35);
      --ctrl-bg:          rgba(255,255,255,0.93);
      --ctrl-border:      rgba(13,27,62,0.13);
      --ctrl-icon:        #0d1b3e;              /* dark icons on white */
      --dropdown-bg:      #ffffff;
      --dropdown-hover:   rgba(13,27,62,0.05);
      --dropdown-div:     rgba(13,27,62,0.06);
      --legend-text:      #2a3a6a;
      --panel-bg:         #ffffff;
      --panel-tab-active: #0d1b3e;
      --panel-tab-text:   #4a5580;
      --panel-tab-active-text: #ffffff;
      --chip-bg:          #eef1f8;
      --chip-border:      rgba(13,27,62,0.10);
      --card-bg:          rgba(201,151,58,0.08);
      --card-border:      rgba(201,151,58,0.20);
      --toast-bg:         #0d1b3e;
      --toast-border:     rgba(255,255,255,0.15);
      --scroll-thumb:     rgba(13,27,62,0.15);
      --map-filter:       saturate(1) brightness(1);
    }

    /* â”€â”€ BASE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    html, body {
      height: 100%; overflow: hidden;
      font-family: 'DM Sans', sans-serif;
      background: var(--bg);
      color: var(--text-primary);
    }

    /* â”€â”€ MAP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #map {
      position: absolute; inset: 0; z-index: 0;
      filter: var(--map-filter);
      transition: filter 0.45s var(--ease);
    }

    /* â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #header { position: absolute; top: 0; left: 0; right: 0; z-index: 900; padding: 14px 14px 0; }
    .header-row { display: flex; align-items: center; gap: 10px; }

    .logo {
      display: flex; align-items: center; gap: 9px;
      background: var(--maroon); color: var(--text-on-brand);
      padding: 9px 15px; border-radius: 50px;
      flex-shrink: 0; box-shadow: var(--shadow); text-decoration: none; user-select: none;
    }
    .logo-mark { font-size: 18px; line-height: 1; }
    .logo-text { font-family: 'Playfair Display', serif; font-size: 14px; font-weight: 700; line-height: 1; }
    .logo-sub  { font-size: 9px; font-weight: 300; opacity: 0.65; letter-spacing: 0.09em; text-transform: uppercase; }

    .search-wrap { flex: 1; position: relative; }
    #search-input {
      width: 100%;
      background: var(--header-bg);
      backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px);
      border: 1.5px solid var(--ctrl-border);
      color: var(--text-on-brand);
      font-family: 'DM Sans', sans-serif; font-size: 14px;
      padding: 11px 44px 11px 18px; border-radius: 50px; outline: none;
      box-shadow: var(--shadow); transition: border-color 0.3s;
    }
    #search-input::placeholder { color: var(--text-placeholder); opacity: 1; }
    #search-input:focus { border-color: var(--gold-ring); }
    .search-icon {
      position: absolute; right: 14px; top: 50%;
      transform: translateY(-50%); pointer-events: none;
      color: var(--text-secondary);
    }
    .search-icon svg { width: 17px; height: 17px; fill: none; stroke: currentColor; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }

    .hdr-btns { display: flex; gap: 8px; flex-shrink: 0; }
    .hdr-btn {
      height: 40px; padding: 0 13px; border-radius: 50px;
      border: 1.5px solid var(--ctrl-border); background: var(--header-bg);
      backdrop-filter: blur(24px); -webkit-backdrop-filter: blur(24px);
      color: var(--text-on-brand);
      font-family: 'DM Sans', sans-serif; font-size: 12px; font-weight: 600;
      cursor: pointer; display: flex; align-items: center; gap: 6px;
      box-shadow: var(--shadow); transition: background 0.2s, border-color 0.2s; white-space: nowrap;
    }
    .hdr-btn:hover { background: rgba(30,49,104,0.96); border-color: rgba(255,255,255,0.22); }
    .hdr-btn svg { width: 15px; height: 15px; fill: none; stroke: currentColor; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }
    #lang-btn { min-width: 58px; justify-content: center; }
    #theme-btn { padding: 0 11px; }

    /* â”€â”€ SEARCH DROPDOWN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #search-results {
      position: absolute; top: calc(100% + 8px); left: 0; right: 0;
      background: var(--dropdown-bg); border: 1.5px solid var(--border);
      border-radius: var(--radius); overflow: hidden;
      box-shadow: var(--shadow-lg); display: none; z-index: 999;
      max-height: 280px; overflow-y: auto;
    }
    #search-results.open { display: block; }
    .sr-item {
      display: flex; align-items: center; gap: 12px;
      padding: 11px 16px; cursor: pointer; transition: background 0.15s;
      border-bottom: 1px solid var(--dropdown-div);
    }
    .sr-item:last-child { border-bottom: none; }
    .sr-item:hover { background: var(--dropdown-hover); }
    .sr-icon { width: 34px; height: 34px; border-radius: 9px; display: grid; place-items: center; font-size: 17px; flex-shrink: 0; }
    .sr-name { font-size: 13px; font-weight: 600; color: var(--text-primary); line-height: 1.3; }
    .sr-meta { font-size: 11px; color: var(--text-secondary); margin-top: 1px; }
    .sr-score { margin-left: auto; font-size: 10px; font-weight: 700; background: var(--gold-soft); color: var(--gold); padding: 2px 8px; border-radius: 50px; flex-shrink: 0; }
    .sr-empty { padding: 18px 16px; font-size: 13px; color: var(--text-secondary); text-align: center; }

    /* â”€â”€ LEGEND â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #legend {
      position: absolute; left: 14px; bottom: 216px; z-index: 900;
      background: var(--glass);
      backdrop-filter: blur(18px); -webkit-backdrop-filter: blur(18px);
      border: 1.5px solid var(--border); border-radius: var(--radius);
      padding: 12px 14px; box-shadow: var(--shadow);
    }
    .legend-title { font-size: 9px; font-weight: 700; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.13em; margin-bottom: 8px; }
    .legend-item  { display: flex; align-items: center; gap: 8px; font-size: 11.5px; color: var(--legend-text); margin-bottom: 5px; }
    .legend-item:last-child { margin-bottom: 0; }
    .legend-dot   { width: 9px; height: 9px; border-radius: 50%; flex-shrink: 0; }

    /* â”€â”€ FLOAT CONTROLS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #controls {
      position: absolute; right: 14px; bottom: 216px; z-index: 900;
      display: flex; flex-direction: column; gap: 9px;
    }
    .ctrl-btn {
      width: 46px; height: 46px; border-radius: 50%; border: none; cursor: pointer;
      display: grid; place-items: center;
      box-shadow: var(--shadow); transition: transform 0.18s, box-shadow 0.18s;
    }
    .ctrl-btn:active { transform: scale(0.9); }
    .ctrl-btn svg { width: 20px; height: 20px; fill: none; stroke: currentColor; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }

    /* Zoom + Centre â€” surfaces from variables so they flip in light mode */
    #btn-zi, #btn-zo, #btn-center {
      background: var(--ctrl-bg);
      border: 1.5px solid var(--ctrl-border);
      color: var(--ctrl-icon);
      backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
    }
    #btn-zi:hover, #btn-zo:hover, #btn-center:hover { background: var(--surface-raised); }

    /* Locate â€” gold normally, blue when tracking is active */
    #btn-locate { background: var(--gold); color: var(--bg); }
    #btn-locate:hover { box-shadow: 0 6px 24px rgba(201,151,58,0.60); }
    #btn-locate.active { background: #1976d2; color: #ffffff; box-shadow: 0 6px 24px rgba(25,118,210,0.55); }

    /* â”€â”€ BLUE PULSE DOT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @keyframes pulse-ring {
      0%   { transform: scale(1);   opacity: 0.7; }
      70%  { transform: scale(2.5); opacity: 0; }
      100% { transform: scale(2.5); opacity: 0; }
    }
    .blue-dot-wrap {
      position: relative; width: 20px; height: 20px;
      display: flex; align-items: center; justify-content: center;
    }
    .blue-dot-pulse {
      position: absolute; width: 20px; height: 20px; border-radius: 50%;
      background: rgba(25,118,210,0.42);
      animation: pulse-ring 2s ease-out infinite;
    }
    .blue-dot-core {
      position: relative; width: 14px; height: 14px; border-radius: 50%;
      background: #1976d2; border: 2.5px solid #ffffff;
      box-shadow: 0 2px 10px rgba(25,118,210,0.65); z-index: 1;
    }

    /* â”€â”€ PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #panel {
      position: absolute; left: 0; right: 0; bottom: 0;
      z-index: 950; max-height: 84vh;
      transform: translateY(100%); transition: transform 0.38s var(--ease);
      display: flex; flex-direction: column; pointer-events: none;
    }
    #panel.open { transform: translateY(0); pointer-events: all; }

    .panel-inner {
      background: var(--panel-bg);
      border-radius: 22px 22px 0 0;
      border-top: 1.5px solid var(--border);
      box-shadow: 0 -16px 60px rgba(0,0,0,0.50);
      display: flex; flex-direction: column; overflow: hidden; flex: 1;
    }
    .panel-handle-row { display: flex; justify-content: center; padding: 12px 0 6px; flex-shrink: 0; }
    .panel-handle { width: 38px; height: 4px; border-radius: 2px; background: var(--border); }

    .panel-hero { height: 104px; position: relative; overflow: hidden; flex-shrink: 0; }
    .panel-hero-bg { position: absolute; inset: 0; }
    .panel-hero-pattern {
      position: absolute; inset: 0;
      background-image: radial-gradient(circle,rgba(255,255,255,0.045) 1px,transparent 1px);
      background-size: 22px 22px;
    }
    .panel-hero-content { position: absolute; inset: 0; padding: 14px 18px; display: flex; flex-direction: column; justify-content: flex-end; }
    .panel-badge {
      display: inline-flex; align-items: center; gap: 5px;
      padding: 3px 10px; border-radius: 50px;
      font-size: 10px; font-weight: 700; letter-spacing: 0.05em;
      text-transform: uppercase; margin-bottom: 6px; width: fit-content;
      color: var(--text-on-brand);
    }
    .panel-name   { font-family: 'Playfair Display', serif; font-size: 21px; font-weight: 700; color: var(--text-on-brand); line-height: 1.1; }
    .panel-common { font-size: 12px; color: rgba(255,255,255,0.58); margin-top: 3px; }

    .panel-close {
      position: absolute; top: 12px; right: 14px;
      width: 30px; height: 30px; border-radius: 50%; border: none;
      background: rgba(0,0,0,0.28); color: var(--text-on-brand);
      cursor: pointer; display: grid; place-items: center; z-index: 5;
      transition: background 0.18s;
    }
    .panel-close:hover { background: rgba(0,0,0,0.45); }
    .panel-close svg { width: 14px; height: 14px; fill: none; stroke: currentColor; stroke-width: 2.5; stroke-linecap: round; }

    .panel-body { overflow-y: auto; flex: 1; padding: 16px 18px 28px; -webkit-overflow-scrolling: touch; }
    .panel-body::-webkit-scrollbar { width: 4px; }
    .panel-body::-webkit-scrollbar-track { background: transparent; }
    .panel-body::-webkit-scrollbar-thumb { background: var(--scroll-thumb); border-radius: 2px; }

    .panel-tabs { display: flex; gap: 4px; margin-bottom: 16px; background: var(--surface-alt); padding: 4px; border-radius: 10px; }
    .tab-btn {
      flex: 1; padding: 8px; border: none; cursor: pointer; border-radius: 7px;
      font-family: 'DM Sans', sans-serif; font-size: 12px; font-weight: 600;
      color: var(--panel-tab-text); background: transparent;
      transition: background 0.2s, color 0.2s;
    }
    .tab-btn.active { background: var(--panel-tab-active); color: var(--panel-tab-active-text); }
    .tab-panel { display: none; }
    .tab-panel.active { display: block; }

    .info-section { margin-bottom: 16px; }
    .info-label { font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em; color: var(--gold); margin-bottom: 6px; }
    .info-text  { font-size: 13.5px; color: var(--text-secondary); line-height: 1.7; }

    .student-card { background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 12px; padding: 14px; margin-bottom: 16px; }
    .student-card-header { display: flex; align-items: center; gap: 8px; font-size: 11px; font-weight: 700; color: var(--gold); text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 8px; }
    .student-card-header svg { width: 14px; height: 14px; fill: none; stroke: currentColor; stroke-width: 2.5; stroke-linecap: round; stroke-linejoin: round; }
    .student-card p { font-size: 13px; color: var(--text-secondary); line-height: 1.65; }

    .quick-facts { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 16px; }
    .fact-chip { background: var(--chip-bg); border: 1px solid var(--chip-border); border-radius: 10px; padding: 10px 12px; }
    .fact-chip-label { font-size: 10px; color: var(--text-secondary); font-weight: 600; text-transform: uppercase; letter-spacing: 0.07em; }
    .fact-chip-value { font-size: 13px; font-weight: 600; color: var(--text-primary); margin-top: 3px; }

    .panel-actions { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .action-btn {
      display: flex; align-items: center; justify-content: center; gap: 8px;
      padding: 13px; border-radius: 12px; border: none; cursor: pointer;
      font-family: 'DM Sans', sans-serif; font-size: 13px; font-weight: 600;
      transition: opacity 0.18s, transform 0.18s;
    }
    .action-btn:active { transform: scale(0.96); opacity: 0.8; }
    .action-btn svg { width: 16px; height: 16px; fill: none; stroke: currentColor; stroke-width: 2.5; stroke-linecap: round; stroke-linejoin: round; }
    .action-primary   { background: var(--maroon-b); color: var(--text-on-brand); }
    .action-secondary { background: var(--surface-alt); border: 1.5px solid var(--border); color: var(--text-secondary); }

    /* â”€â”€ DESKTOP SIDEBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media (min-width: 640px) {
      #panel {
        left: 16px; right: auto; bottom: 16px; top: 78px;
        width: 360px; max-height: calc(100vh - 94px);
        transform: translateX(-115%); transition: transform 0.38s var(--ease);
      }
      #panel.open { transform: translateX(0); }
      .panel-inner { border-radius: var(--radius-lg); }
      .panel-handle-row { display: none; }
    }

    /* â”€â”€ LOCATION ERROR BANNER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #loc-error {
      position: absolute; bottom: 210px; left: 50%;
      transform: translateX(-50%) translateY(20px);
      z-index: 960; max-width: 320px; width: calc(100% - 40px);
      background: #2d1515;
      border: 1.5px solid rgba(168,41,62,0.45);
      color: #f4a0a0;
      padding: 14px 18px; border-radius: var(--radius);
      font-size: 13px; line-height: 1.55;
      box-shadow: var(--shadow-lg);
      opacity: 0; pointer-events: none;
      transition: opacity 0.32s, transform 0.32s; text-align: center;
    }
    #loc-error.show { opacity: 1; transform: translateX(-50%) translateY(0); pointer-events: all; }
    body.light #loc-error { background: #fff0f0; border-color: rgba(168,41,62,0.28); color: #7b1d2e; }
    #loc-error-close {
      display: inline-block; margin-top: 9px;
      font-size: 11px; font-weight: 700; cursor: pointer;
      color: var(--gold); text-transform: uppercase; letter-spacing: 0.07em;
    }

    /* â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #toast {
      position: absolute; bottom: 210px; left: 50%;
      transform: translateX(-50%) translateY(16px);
      z-index: 961; background: var(--toast-bg);
      color: var(--text-primary); padding: 10px 20px;
      border-radius: 50px; font-size: 13px; font-weight: 500;
      border: 1px solid var(--toast-border);
      box-shadow: var(--shadow); opacity: 0; pointer-events: none; white-space: nowrap;
      transition: opacity 0.28s, transform 0.28s;
    }
    #toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

    /* â”€â”€ BUK MARKERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .buk-marker {
      width: 36px; height: 36px; border-radius: 50% 50% 50% 0;
      transform: rotate(-45deg); display: grid; place-items: center;
      box-shadow: 0 4px 14px rgba(0,0,0,0.45);
      border: 2.5px solid rgba(255,255,255,0.88); cursor: pointer;
    }
    .buk-marker .mi { transform: rotate(45deg); font-size: 15px; line-height: 1; }
    .buk-marker.active { border-color: var(--gold); transform: rotate(-45deg) scale(1.22); }

    /* â”€â”€ LEAFLET OVERRIDES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .leaflet-control-zoom { display: none !important; }
    .leaflet-control-attribution { background: var(--glass) !important; color: var(--text-secondary) !important; font-size: 10px !important; }
    .leaflet-control-attribution a { color: var(--text-secondary) !important; }
  </style>
</head>
<body>

<div id="map"></div>

<!-- â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="header">
  <div class="header-row">
    <div class="logo">
      <span class="logo-mark">ğŸ—º</span>
      <div>
        <div class="logo-text">BUK Nav</div>
        <div class="logo-sub" data-i18n="oldSite">Old Site</div>
      </div>
    </div>
    <div class="search-wrap">
      <input type="text" id="search-input" autocomplete="off" />
      <div class="search-icon">
        <svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
      </div>
      <div id="search-results"></div>
    </div>
    <div class="hdr-btns">
      <button class="hdr-btn" id="lang-btn">
        <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
        <span id="lang-label">HA</span>
      </button>
      <button class="hdr-btn" id="theme-btn">
        <svg id="theme-icon" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
      </button>
    </div>
  </div>
</div>

<!-- â”€â”€ LEGEND â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="legend">
  <div class="legend-title" data-i18n="categories">Categories</div>
  <div class="legend-item"><div class="legend-dot" style="background:#c9973a"></div><span data-i18n="catFaculty">Faculty</span></div>
  <div class="legend-item"><div class="legend-dot" style="background:#a8293e"></div><span data-i18n="catTheater">Theater</span></div>
  <div class="legend-item"><div class="legend-dot" style="background:#1e88e5"></div><span data-i18n="catLibrary">Library</span></div>
  <div class="legend-item"><div class="legend-dot" style="background:#388e3c"></div><span data-i18n="catOffice">Office</span></div>
</div>

<!-- â”€â”€ FLOAT CONTROLS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="controls">
  <button class="ctrl-btn" id="btn-zi">
    <svg viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
  </button>
  <button class="ctrl-btn" id="btn-zo">
    <svg viewBox="0 0 24 24"><line x1="5" y1="12" x2="19" y2="12"/></svg>
  </button>
  <button class="ctrl-btn" id="btn-center" title="Centre on BUK">
    <!-- crosshair / home icon -->
    <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="9"/><line x1="12" y1="1" x2="12" y2="5"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="1" y1="12" x2="5" y2="12"/><line x1="19" y1="12" x2="23" y2="12"/><circle cx="12" cy="12" r="2" fill="currentColor" stroke="none"/></svg>
  </button>
  <button class="ctrl-btn" id="btn-locate">
    <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M12 2v3M12 19v3M2 12h3M19 12h3"/><circle cx="12" cy="12" r="8" stroke-dasharray="3 2"/></svg>
  </button>
</div>

<!-- â”€â”€ PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="panel">
  <div class="panel-inner">
    <div class="panel-handle-row"><div class="panel-handle"></div></div>
    <div class="panel-hero">
      <div class="panel-hero-bg" id="panel-hero-bg"></div>
      <div class="panel-hero-pattern"></div>
      <div class="panel-hero-content">
        <div class="panel-badge"  id="panel-badge"></div>
        <div class="panel-name"   id="panel-name"></div>
        <div class="panel-common" id="panel-common"></div>
      </div>
      <button class="panel-close" id="panel-close">
        <svg viewBox="0 0 24 24"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
    </div>
    <div class="panel-body">
      <div class="panel-tabs">
        <button class="tab-btn active" data-tab="info"  data-i18n="tabInfo">About</button>
        <button class="tab-btn"        data-tab="tips"  data-i18n="tabTips">Student Tips</button>
        <button class="tab-btn"        data-tab="facts" data-i18n="tabFacts">Quick Facts</button>
      </div>

      <div class="tab-panel active" id="tab-info">
        <div class="info-section">
          <div class="info-label" data-i18n="labelDesc">Description</div>
          <div class="info-text" id="panel-desc"></div>
        </div>
        <div class="panel-actions">
          <button class="action-btn action-primary" id="btn-navigate">
            <svg viewBox="0 0 24 24"><polygon points="3 11 22 2 13 21 11 13 3 11"/></svg>
            <span data-i18n="navigate">Navigate</span>
          </button>
          <button class="action-btn action-secondary" id="btn-share">
            <svg viewBox="0 0 24 24"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
            <span data-i18n="share">Share</span>
          </button>
        </div>
      </div>

      <div class="tab-panel" id="tab-tips">
        <div class="student-card">
          <div class="student-card-header">
            <svg viewBox="0 0 24 24"><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 3 9 3 12 0v-5"/></svg>
            <span data-i18n="studentTip">Student Tip</span>
          </div>
          <p id="panel-students"></p>
        </div>
        <div class="panel-actions">
          <button class="action-btn action-primary" id="btn-navigate2">
            <svg viewBox="0 0 24 24"><polygon points="3 11 22 2 13 21 11 13 3 11"/></svg>
            <span data-i18n="navigate">Navigate</span>
          </button>
          <button class="action-btn action-secondary" id="btn-save">
            <svg viewBox="0 0 24 24"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/></svg>
            <span data-i18n="save">Save</span>
          </button>
        </div>
      </div>

      <div class="tab-panel" id="tab-facts">
        <div class="quick-facts" id="panel-facts"></div>
        <div class="panel-actions" style="margin-top:4px">
          <button class="action-btn action-primary" id="btn-navigate3">
            <svg viewBox="0 0 24 24"><polygon points="3 11 22 2 13 21 11 13 3 11"/></svg>
            <span data-i18n="navigate">Navigate</span>
          </button>
          <button class="action-btn action-secondary" id="btn-share2">
            <svg viewBox="0 0 24 24"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
            <span data-i18n="share">Share</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- â”€â”€ LOCATION ERROR BANNER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="loc-error">
  <div id="loc-error-msg"></div>
  <div id="loc-error-close" data-i18n="dismiss">Dismiss</div>
</div>

<!-- â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div id="toast"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/7.0.0/fuse.min.js"></script>
<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   i18n
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const translations = {
  en: {
    oldSite:"Old Site", searchPlaceholder:"Search buildings, facultiesâ€¦",
    categories:"Categories", catFaculty:"Faculty", catTheater:"Theater",
    catLibrary:"Library", catOffice:"Office",
    tabInfo:"About", tabTips:"Student Tips", tabFacts:"Quick Facts",
    labelDesc:"Description", navigate:"Navigate", share:"Share", save:"Save",
    studentTip:"Student Tip",
    locating:"Locating youâ€¦",
    locationFound:"Blue dot placed â€” you are here!",
    locationUpdated:"Position updated.",
    trackingOn:"Live tracking active.", trackingOff:"Live tracking stopped.",
    centerDone:"Centred on BUK Old Site.",
    navSoon:"GPS routing coming in v4!",
    shareDone:"Link copied!", saveDone:"Location saved!",
    dismiss:"Dismiss", noResults:"No results found",
    errDenied:"Location access denied. Please allow location permissions in your browser settings to use this feature.",
    errUnavailable:"Location unavailable. Make sure GPS is enabled on your device.",
    errTimeout:"Location request timed out. Please try again.",
    errUnsupported:"Your browser does not support geolocation.",
  },
  ha: {
    oldSite:"Tsohon Wurin", searchPlaceholder:"Nemo gini, azuzuwanâ€¦",
    categories:"Nau'ikan", catFaculty:"Azuzuwan", catTheater:"Filin Taro",
    catLibrary:"Dakin Karatu", catOffice:"Ofis",
    tabInfo:"Bayani", tabTips:"Nasihar Dalibi", tabFacts:"Bayanai GabaÉ—aya",
    labelDesc:"Bayanin Wuri", navigate:"Bi Hanya", share:"Raba", save:"Ajiye",
    studentTip:"Nasihar Dalibi",
    locating:"Ana nemo wurinkaâ€¦",
    locationFound:"An nemo wuri â€” kana nan!",
    locationUpdated:"An sabunta matsayinka.",
    trackingOn:"Ana bin sawun wuri.", trackingOff:"An dakatar da bin wuri.",
    centerDone:"An dawo tsakiyar BUK.",
    navSoon:"Jagoran GPS zai zo a v4!",
    shareDone:"An kwafi hanyar!", saveDone:"An ajiye wuri!",
    dismiss:"Rufe", noResults:"Ba a sami sakamako ba",
    errDenied:"An hana damar wuri. Don Allah ka yarda da dama a saitunan browser É—inka don amfani da wannan fasalin.",
    errUnavailable:"Ba a sami wuri ba. Tabbatar GPS yana aiki a na'urarka.",
    errTimeout:"BuÆ™atar wuri ta É—auki lokaci mai yawa. Don Allah sake gwadawa.",
    errUnsupported:"Browser É—inka baya goyan bayan geolocation.",
  }
};

let currentLang = 'en';
const t = k => translations[currentLang][k] ?? translations.en[k] ?? k;

function applyTranslations() {
  document.querySelectorAll('[data-i18n]').forEach(el => { el.textContent = t(el.dataset.i18n); });
  document.getElementById('search-input').placeholder = t('searchPlaceholder');
  document.getElementById('lang-label').textContent   = currentLang === 'en' ? 'HA' : 'EN';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LANDMARKS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const bukLandmarks = [
  {
    id:'fais', category:'Faculty', emoji:'ğŸ“š', color:'#c9973a',
    heroBg:'linear-gradient(135deg,#7a5a1a,#1e3168)',
    name_en:"Faculty of Arts & Islamic Studies", name_ha:"Fakaltun Fasaha da Karatun Musulunci",
    commonName_en:"FAIS Building", commonName_ha:"Ginin FAIS",
    desc_en:"Home to the departments of Arabic, Islamic Studies, History, and English Language. One of BUK's oldest and most distinguished faculties, recognised for rigorous academic tradition, a landmark arched entrance, and a serene courtyard.",
    desc_ha:"Cibiyar dakunan karantar Larabci, Karatun Musulunci, Tarihi, da Turanci. ÆŠaya daga cikin tsofaffin azuzuwan BUK, sananne don tsananin al'adar ilimi da Æ™ofofinsa masu kama da baka.",
    students_en:"Great shortcut to the Main Library â€” exit through the east door for a 3-minute walk. Timetable boards are at the main archway every Monday.",
    students_ha:"Hanyar gajere zuwa Babban Dakin Karatu tana ta Æ™ofar gabas â€” minti 3 tafiyar Æ™afa. Ana É—ora jadawalin darussa a bakin Æ™ofa kowace Litinin.",
    facts:{
      en:[{label:"Founded",value:"1977"},{label:"Departments",value:"6"},{label:"Category",value:"Faculty"},{label:"Zone",value:"North Block"}],
      ha:[{label:"An Kafa",value:"1977"},{label:"Sassan Karatu",value:"6"},{label:"Nau'i",value:"Azuzuwan"},{label:"Yanki",value:"Arewacin Ginin"}]
    },
    coords:{lat:11.9815,lng:8.4740}
  },
  {
    id:'convo', category:'Theater', emoji:'ğŸ“', color:'#a8293e',
    heroBg:'linear-gradient(135deg,#7b1d2e,#0d1b3e)',
    name_en:"Convocation Arena", name_ha:"Filin Bikin Kammala Karatu",
    commonName_en:"The Convo", commonName_ha:"Filin Bikin",
    desc_en:"The grand outdoor arena that serves as the ceremonial heart of BUK. Hosts annual convocation ceremonies, presidential visits, public lectures, and inter-faculty competitions. Seats thousands under the open sky.",
    desc_ha:"Babban filin waje wanda ke zama zuciyar bikin BUK. Ana yin bikin kammala karatu na shekara-shekara, ziyarori na shugabanci, lacca na jama'a da gasar azuzuwa a nan.",
    students_en:"Arrive 45 minutes early for convocation â€” parking fills fast. The east entrance (near the faculty gate) has shorter queues than the main gate.",
    students_ha:"Zo aÆ™alla minti 45 kafin bikin kammala karatu â€” wurin ajiye mota yana cika. Æ˜ofar gabas tana da É—an gajeren jerin mutane.",
    facts:{
      en:[{label:"Capacity",value:"~5,000"},{label:"Type",value:"Outdoor Arena"},{label:"Category",value:"Theater"},{label:"Zone",value:"Central"}],
      ha:[{label:"Iya KarÉ“a",value:"~5,000"},{label:"Nau'i",value:"Filin Waje"},{label:"Nau'in",value:"Filin Taro"},{label:"Yanki",value:"Tsakiya"}]
    },
    coords:{lat:11.9800,lng:8.4760}
  },
  {
    id:'library', category:'Library', emoji:'ğŸ“–', color:'#1e88e5',
    heroBg:'linear-gradient(135deg,#1565c0,#162348)',
    name_en:"Central Library", name_ha:"Babban Dakin Karatu",
    commonName_en:"The Main Library", commonName_ha:"Babban Laburare",
    desc_en:"A multi-storey academic library housing thousands of printed volumes, bound journals, research theses, and digital resources. The primary research hub for all BUK students and faculty.",
    desc_ha:"Laburaren ilimi mai hawa da yawa wanda ke É—auke da dubban littattafai, jaridu, rubuce-rubuce na bincike, da albarkatu na dijital.",
    students_en:"Bring your student ID â€” access requires it. The 2nd floor has the quietest reading area. Printing at â‚¦10/page. Opens 8 AM daily.",
    students_ha:"Kawo katin dalibinka â€” ana buÆ™atarsa don shiga. Hawa na 2 yana da mafi natsuwa wurin karatu. Ana buga takarda â‚¦10/shafi. Ana bude karfe 8 na safe.",
    facts:{
      en:[{label:"Floors",value:"4"},{label:"Open",value:"8 AM â€“ 9 PM"},{label:"Category",value:"Library"},{label:"Zone",value:"West Block"}],
      ha:[{label:"Hawa",value:"4"},{label:"BuÉ—ewa",value:"8 AM â€“ 9 PM"},{label:"Nau'i",value:"Dakin Karatu"},{label:"Yanki",value:"Yammacin Ginin"}]
    },
    coords:{lat:11.9795,lng:8.4730}
  },
  {
    id:'sms', category:'Faculty', emoji:'ğŸ›', color:'#c9973a',
    heroBg:'linear-gradient(135deg,#7a5a1a,#1e3168)',
    name_en:"Faculty of Social & Management Sciences", name_ha:"Fakaltun Kimiyyar Zamantakewa da Gudanarwa",
    commonName_en:"SMS Faculty", commonName_ha:"Fakaltun SMS",
    desc_en:"Hosts departments of Economics, Business Administration, Political Science, Sociology, and Mass Communication. Features a modern multi-level lecture complex and a dedicated postgraduate wing.",
    desc_ha:"Cibiyar dakunan karantar Tattalin Arziki, Gudanar da Kasuwanci, Kimiyyar Siyasa, Ilimin Zamantakewa, da Sadarwa ga Jama'a.",
    students_en:"The SMS student lounge on the ground floor has strong WiFi, open until 10 PM â€” ideal for group work. Check the Dean's notice board for scholarship updates.",
    students_ha:"Zauren É—alibai na SMS a hawa na farko yana da Æ™arfin WiFi, buÉ—e har 10 na dare. Duba allon sanarwa kusa da ofishin Dean.",
    facts:{
      en:[{label:"Founded",value:"1981"},{label:"Departments",value:"5"},{label:"Category",value:"Faculty"},{label:"Zone",value:"East Block"}],
      ha:[{label:"An Kafa",value:"1981"},{label:"Sassan Karatu",value:"5"},{label:"Nau'i",value:"Azuzuwan"},{label:"Yanki",value:"Gabashin Ginin"}]
    },
    coords:{lat:11.9820,lng:8.4780}
  },
  {
    id:'vc', category:'Office', emoji:'ğŸ¢', color:'#388e3c',
    heroBg:'linear-gradient(135deg,#2e6b31,#162348)',
    name_en:"Vice Chancellor's Office", name_ha:"Ofishin Mataimakin Shugaban Jami'a",
    commonName_en:"VC's Lodge", commonName_ha:"Ofishin VC",
    desc_en:"The central administrative nucleus of Bayero University Kano. Houses the Vice-Chancellor, Deputy VCs, Registrar, and key management offices. Surrounded by manicured grounds and a flagpole plaza.",
    desc_ha:"Cibiyar gudanarwa ta Jami'ar Bayero Kano. Ofishin Mataimakin Shugaban Jami'a, Mataimakai, da manyan ofisoshin gudanarwa suna nan.",
    students_en:"Administrative queries (transcripts, deferral, bursary) are at the ground floor helpdesk. Best visited 9â€“11 AM. Smart dress expected.",
    students_ha:"Ana magance tambayoyin gudanarwa a tebur na taimako. Mafi kyau zuwa tsakanin karfe 9â€“11 na safe. Ana tsammani sutura mai kyau.",
    facts:{
      en:[{label:"Type",value:"Administration"},{label:"Hours",value:"8 AM â€“ 4 PM"},{label:"Category",value:"Office"},{label:"Zone",value:"Central"}],
      ha:[{label:"Nau'i",value:"Gudanarwa"},{label:"Sa'o'i",value:"8 AM â€“ 4 PM"},{label:"Nau'in",value:"Ofis"},{label:"Yanki",value:"Tsakiya"}]
    },
    coords:{lat:11.9808,lng:8.4748}
  }
];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FUSE.JS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buildFuse() {
  return new Fuse(bukLandmarks.map(l=>({
    id:l.id, name_en:l.name_en, name_ha:l.name_ha,
    common_en:l.commonName_en, common_ha:l.commonName_ha, category:l.category
  })), {
    threshold:0.4, includeScore:true,
    keys:[
      {name:'name_en',weight:0.35},{name:'name_ha',weight:0.35},
      {name:'common_en',weight:0.15},{name:'common_ha',weight:0.15},
      {name:'category',weight:0.10}
    ]
  });
}
let fuse = buildFuse();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const BUK_CENTER = [11.9808, 8.4755];
const BUK_ZOOM   = 17;

const map = L.map('map', { center:BUK_CENTER, zoom:BUK_ZOOM, zoomControl:false });

const darkTiles = L.tileLayer(
  'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png',
  {attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OSM</a> &copy; <a href="https://carto.com/">CARTO</a>',subdomains:'abcd',maxZoom:20}
).addTo(map);

const lightTiles = L.tileLayer(
  'https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png',
  {attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OSM</a> &copy; <a href="https://carto.com/">CARTO</a>',subdomains:'abcd',maxZoom:20}
);

/* â”€â”€ BUK markers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const markerRefs = {};
function bukIcon(l, active=false) {
  return L.divIcon({
    html:`<div class="buk-marker${active?' active':''}" style="background:${l.color}"><span class="mi">${l.emoji}</span></div>`,
    className:'', iconSize:[36,36], iconAnchor:[18,36]
  });
}
bukLandmarks.forEach(l => {
  const m = L.marker([l.coords.lat,l.coords.lng],{icon:bukIcon(l)}).addTo(map);
  m.on('click',()=>openPanel(l));
  markerRefs[l.id]={marker:m,landmark:l};
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LIVE LOCATION â€” Blue Dot + Accuracy Circle (Task 2)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let blueDot      = null;
let accCircle    = null;
let watchId      = null;
let firstFix     = true;

function blueDotIcon() {
  return L.divIcon({
    html:`<div class="blue-dot-wrap"><div class="blue-dot-pulse"></div><div class="blue-dot-core"></div></div>`,
    className:'', iconSize:[20,20], iconAnchor:[10,10]
  });
}

function onPosition(pos) {
  const {latitude:lat, longitude:lng, accuracy} = pos.coords;

  /* Place or move the blue dot */
  if (!blueDot) {
    blueDot = L.marker([lat,lng],{icon:blueDotIcon(), zIndexOffset:1000}).addTo(map);
  } else {
    blueDot.setLatLng([lat,lng]);
  }

  /* Place or resize the GPS accuracy circle */
  if (!accCircle) {
    accCircle = L.circle([lat,lng],{
      radius:accuracy, color:'#1976d2', fillColor:'#1976d2',
      fillOpacity:0.10, weight:1.5, dashArray:'4 3'
    }).addTo(map);
  } else {
    accCircle.setLatLng([lat,lng]);
    accCircle.setRadius(accuracy);
  }

  if (firstFix) {
    map.flyTo([lat,lng], 18, {duration:1.1});
    showToast(t('locationFound'));
    firstFix = false;
  } else {
    showToast(t('locationUpdated'));
  }
}

function onPositionError(err) {
  const keys = {1:'errDenied', 2:'errUnavailable', 3:'errTimeout'};
  showLocError(t(keys[err.code] || 'errUnavailable'));
  stopTracking();
}

function startTracking() {
  if (!navigator.geolocation) { showLocError(t('errUnsupported')); return; }
  firstFix = true;
  showToast(t('locating'));
  document.getElementById('btn-locate').classList.add('active');
  watchId = navigator.geolocation.watchPosition(onPosition, onPositionError,
    {enableHighAccuracy:true, timeout:12000, maximumAge:3000});
}

function stopTracking() {
  if (watchId !== null) { navigator.geolocation.clearWatch(watchId); watchId=null; }
  document.getElementById('btn-locate').classList.remove('active');
}

document.getElementById('btn-locate').addEventListener('click', () => {
  if (watchId !== null) { stopTracking(); showToast(t('trackingOff')); }
  else { startTracking(); }
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CENTRE MAP BUTTON (Task 3)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.getElementById('btn-center').addEventListener('click', () => {
  map.flyTo(BUK_CENTER, BUK_ZOOM, {duration:0.9});
  showToast(t('centerDone'));
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOCATION ERROR BANNER (Task 3)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let errTimer;
function showLocError(msg) {
  const b = document.getElementById('loc-error');
  document.getElementById('loc-error-msg').textContent = msg;
  b.classList.add('show');
  clearTimeout(errTimer);
  errTimer = setTimeout(() => b.classList.remove('show'), 9000);
}
document.getElementById('loc-error-close').addEventListener('click', () =>
  document.getElementById('loc-error').classList.remove('show')
);

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PANEL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const panel = document.getElementById('panel');
let activeId = null;

function populatePanel(l) {
  const lang = currentLang;
  document.getElementById('panel-name').textContent     = lang==='en'?l.name_en:l.name_ha;
  document.getElementById('panel-common').textContent   = lang==='en'?l.commonName_en:l.commonName_ha;
  document.getElementById('panel-desc').textContent     = lang==='en'?l.desc_en:l.desc_ha;
  document.getElementById('panel-students').textContent = lang==='en'?l.students_en:l.students_ha;

  const badge = document.getElementById('panel-badge');
  badge.textContent = `${l.emoji}  ${t('cat'+l.category)}`;
  badge.style.cssText = `background:${l.color}28;color:#fff;border:1px solid ${l.color}70;`;
  document.getElementById('panel-hero-bg').style.background = l.heroBg;

  const facts = l.facts[lang] || l.facts.en;
  document.getElementById('panel-facts').innerHTML = facts.map(f=>
    `<div class="fact-chip"><div class="fact-chip-label">${f.label}</div><div class="fact-chip-value">${f.value}</div></div>`
  ).join('');
}

function openPanel(l) {
  activeId = l.id;
  Object.values(markerRefs).forEach(({marker,landmark:lm})=>marker.setIcon(bukIcon(lm,false)));
  markerRefs[l.id].marker.setIcon(bukIcon(l,true));
  populatePanel(l);
  setTab('info');
  panel.classList.add('open');
  map.flyTo([l.coords.lat,l.coords.lng],18,{duration:0.75});
}

function updatePanelText() {
  if (!activeId) return;
  const l = bukLandmarks.find(x=>x.id===activeId);
  if (l) populatePanel(l);
}

function closePanel() {
  panel.classList.remove('open');
  if (activeId) { markerRefs[activeId].marker.setIcon(bukIcon(markerRefs[activeId].landmark,false)); activeId=null; }
}

document.getElementById('panel-close').addEventListener('click', closePanel);
map.on('click', closePanel);

function setTab(name) {
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.toggle('active',b.dataset.tab===name));
  document.querySelectorAll('.tab-panel').forEach(p=>p.classList.toggle('active',p.id==='tab-'+name));
}
document.querySelectorAll('.tab-btn').forEach(btn=>btn.addEventListener('click',()=>setTab(btn.dataset.tab)));

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SEARCH
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const searchInput = document.getElementById('search-input');
const searchBox   = document.getElementById('search-results');

searchInput.addEventListener('input', () => {
  const q = searchInput.value.trim();
  searchBox.innerHTML='';
  if (!q) { searchBox.classList.remove('open'); return; }
  const results = fuse.search(q).slice(0,6);
  if (!results.length) {
    searchBox.innerHTML=`<div class="sr-empty">${t('noResults')}</div>`;
    searchBox.classList.add('open'); return;
  }
  results.forEach(({item,score})=>{
    const l = bukLandmarks.find(x=>x.id===item.id); if (!l) return;
    const name   = currentLang==='en'?l.name_en:l.name_ha;
    const common = currentLang==='en'?l.commonName_en:l.commonName_ha;
    const pct    = Math.round((1-score)*100);
    const div    = document.createElement('div');
    div.className='sr-item';
    div.innerHTML=`
      <div class="sr-icon" style="background:${l.color}22;font-size:18px">${l.emoji}</div>
      <div style="flex:1;min-width:0">
        <div class="sr-name">${name}</div>
        <div class="sr-meta">${t('cat'+l.category)} Â· ${common}</div>
      </div>
      <div class="sr-score">${pct}%</div>`;
    div.addEventListener('click',()=>{ searchInput.value=name; searchBox.classList.remove('open'); openPanel(l); });
    searchBox.appendChild(div);
  });
  searchBox.classList.add('open');
});

document.addEventListener('click', e=>{
  if (!searchInput.contains(e.target)&&!searchBox.contains(e.target)) searchBox.classList.remove('open');
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LANGUAGE TOGGLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.getElementById('lang-btn').addEventListener('click', ()=>{
  currentLang = currentLang==='en'?'ha':'en';
  applyTranslations(); updatePanelText(); fuse=buildFuse();
  searchInput.value=''; searchBox.classList.remove('open');
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   THEME TOGGLE  (Task 1 + Task 4)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let isLight = false;
const themeIcon = document.getElementById('theme-icon');
const SUN  = '<circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>';
const MOON = '<path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>';

document.getElementById('theme-btn').addEventListener('click', ()=>{
  isLight=!isLight;
  document.body.classList.toggle('light',isLight);
  if (isLight) { map.removeLayer(darkTiles); lightTiles.addTo(map); themeIcon.innerHTML=SUN; }
  else         { map.removeLayer(lightTiles); darkTiles.addTo(map); themeIcon.innerHTML=MOON; }
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ZOOM
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.getElementById('btn-zi').addEventListener('click',()=>map.zoomIn());
document.getElementById('btn-zo').addEventListener('click',()=>map.zoomOut());

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ACTION BUTTONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
['btn-navigate','btn-navigate2','btn-navigate3'].forEach(id=>
  document.getElementById(id)?.addEventListener('click',()=>showToast(t('navSoon')))
);
['btn-share','btn-share2'].forEach(id=>
  document.getElementById(id)?.addEventListener('click',()=>{ navigator.clipboard?.writeText(location.href); showToast(t('shareDone')); })
);
document.getElementById('btn-save')?.addEventListener('click',()=>showToast(t('saveDone')));

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let toastTimer;
function showToast(msg) {
  const el=document.getElementById('toast');
  el.textContent=msg; el.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer=setTimeout(()=>el.classList.remove('show'),2800);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
applyTranslations();
</script>
</body>
</html>
